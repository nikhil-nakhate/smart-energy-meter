///////////////////////////////////////////////////////////////////////////////
//                                                                            /
//                                                      26/Jan/2012  01:17:01 /
// IAR C/C++ Compiler V5.40.2.20380/W32, Evaluation edition for MSP430        /
// Copyright 1996-2011 IAR Systems AB.                                        /
//                                                                            /
//    __rt_version  =  3                                                      /
//    __double_size =  32                                                     /
//    __reg_r4      =  free                                                   /
//    __reg_r5      =  free                                                   /
//    __pic         =  no                                                     /
//    __core        =  430X                                                   /
//    __data_model  =  small                                                  /
//    Source file   =  C:\Texas Instruments\ZAP-MSP430-2.5.0\Projects\zstack\ /
//                     ZAP\SE-SampleApp\Source\SimpleMeter\simplemeter.c      /
//    Command line  =  -f "C:\Texas Instruments\ZAP-MSP430-2.5.0\Projects\zst /
//                     ack\ZAP\SE-SampleApp\EXP5438\..\..\Source\zap.cfg"     /
//                     (-DZAP_PHY_SPI=1 -DZAP_PHY_UART=!ZAP_PHY_SPI           /
//                     -DZAP_PHY_RESET_ZNP=TRUE -DZAP_ZNP_MT=FALSE            /
//                     -DZAP_APP_MSG=FALSE -DZAP_SBL_PROXY=FALSE              /
//                     -DZAP_AUTO_CFG=TRUE -DZAP_AUTO_START=TRUE              /
//                     -DZAP_NV_RESTORE=FALSE -DLCD_SUPPORTED                 /
//                     -DZAP_AF_DATA_REQ_FRAG=FALSE                           /
//                     -DZAP_AF_DATA_REQ_AREQ=!ZAP_AF_DATA_REQ_FRAG           /
//                     -DZAP_ZDO_STARTUP_AREQ=TRUE -DZAP_AF_FUNC              /
//                     -DZAP_SAPI_FUNC -DZAP_SYS_FUNC -DZAP_UTIL_FUNC         /
//                     -DZAP_ZDO_FUNC -DSECURE=0 -DZG_SECURE_DYNAMIC=0        /
//                     "-DDEFAULT_CHANLIST=(uint32)0x00000800"                /
//                     -DZDAPP_CONFIG_PAN_ID=0xFFFF -DPOLL_RATE=1000          /
//                     -DNWK_START_DELAY=100 -DMAX_BINDING_CLUSTER_IDS=4) -f  /
//                     "C:\Texas Instruments\ZAP-MSP430-2.5.0\Projects\zstack /
//                     \ZAP\SE-SampleApp\EXP5438\..\..\..\Tools\MSP5438\f8wZC /
//                     L.cfg" (-DZCL_READ -DZCL_WRITE -DZCL_BASIC             /
//                     -DZCL_IDENTIFY -DZCL_ON_OFF -DZCL_KEY_ESTABLISH        /
//                     -DZCL_KEY_ESTABLISHMENT_KEY_GENERATE_TIMEOUT=4         /
//                     -DZCL_KEY_ESTABLISHMENT_MAC_GENERATE_TIMEOUT=10        /
//                     -DZCL_KEY_ESTABLISHMENT_EKEY_GENERATE_TIMEOUT=10       /
//                     -DZCL_LOAD_CONTROL -DZCL_SIMPLE_METERING               /
//                     -DZCL_PRICING -DZCL_MESSAGE) "C:\Texas                 /
//                     Instruments\ZAP-MSP430-2.5.0\Projects\zstack\ZAP\SE-Sa /
//                     mpleApp\Source\SimpleMeter\simplemeter.c" -D           /
//                     ZAP_DEVICETYPE=ZG_DEVICETYPE_ENDDEVICE -D              /
//                     TC_LINKKEY_JOIN -D ZCL_REPORT -lC "C:\Texas            /
//                     Instruments\ZAP-MSP430-2.5.0\Projects\zstack\ZAP\SE-Sa /
//                     mpleApp\EXP5438\Simple Metering - End Device\List\"    /
//                     -lA "C:\Texas Instruments\ZAP-MSP430-2.5.0\Projects\zs /
//                     tack\ZAP\SE-SampleApp\EXP5438\Simple Metering - End    /
//                     Device\List\" --remarks --diag_suppress                /
//                     Pe001,Pe193,Pe236,Pe826 -o "C:\Texas                   /
//                     Instruments\ZAP-MSP430-2.5.0\Projects\zstack\ZAP\SE-Sa /
//                     mpleApp\EXP5438\Simple Metering - End Device\Obj\"     /
//                     --debug -D__MSP430F5438__ -e --double=32 --clib -I     /
//                     "C:\Texas Instruments\ZAP-MSP430-2.5.0\Projects\zstack /
//                     \ZAP\SE-SampleApp\EXP5438\" -I "C:\Texas               /
//                     Instruments\ZAP-MSP430-2.5.0\Projects\zstack\ZAP\SE-Sa /
//                     mpleApp\EXP5438\..\Source\" -I "C:\Texas               /
//                     Instruments\ZAP-MSP430-2.5.0\Projects\zstack\ZAP\SE-Sa /
//                     mpleApp\EXP5438\..\..\Source\" -I "C:\Texas            /
//                     Instruments\ZAP-MSP430-2.5.0\Projects\zstack\ZAP\SE-Sa /
//                     mpleApp\EXP5438\..\..\..\..\..\Components\hal\target\M /
//                     SP5438ZAP\" -I "C:\Texas Instruments\ZAP-MSP430-2.5.0\ /
//                     Projects\zstack\ZAP\SE-SampleApp\EXP5438\..\..\..\..\. /
//                     .\Components\hal\include\" -I "C:\Texas                /
//                     Instruments\ZAP-MSP430-2.5.0\Projects\zstack\ZAP\SE-Sa /
//                     mpleApp\EXP5438\..\..\..\..\..\Components\mac\include\ /
//                     " -I "C:\Texas Instruments\ZAP-MSP430-2.5.0\Projects\z /
//                     stack\ZAP\SE-SampleApp\EXP5438\..\..\..\..\..\Componen /
//                     ts\mt\" -I "C:\Texas Instruments\ZAP-MSP430-2.5.0\Proj /
//                     ects\zstack\ZAP\SE-SampleApp\EXP5438\..\..\..\..\..\Co /
//                     mponents\osal\include\" -I "C:\Texas                   /
//                     Instruments\ZAP-MSP430-2.5.0\Projects\zstack\ZAP\SE-Sa /
//                     mpleApp\EXP5438\..\..\..\..\..\Components\osal\mcu\msp /
//                     430\" -I "C:\Texas Instruments\ZAP-MSP430-2.5.0\Projec /
//                     ts\zstack\ZAP\SE-SampleApp\EXP5438\..\..\..\..\..\Comp /
//                     onents\services\saddr\" -I "C:\Texas                   /
//                     Instruments\ZAP-MSP430-2.5.0\Projects\zstack\ZAP\SE-Sa /
//                     mpleApp\EXP5438\..\..\..\..\..\Components\services\sda /
//                     ta\" -I "C:\Texas Instruments\ZAP-MSP430-2.5.0\Project /
//                     s\zstack\ZAP\SE-SampleApp\EXP5438\..\..\..\..\..\Compo /
//                     nents\stack\af\" -I "C:\Texas                          /
//                     Instruments\ZAP-MSP430-2.5.0\Projects\zstack\ZAP\SE-Sa /
//                     mpleApp\EXP5438\..\..\..\..\..\Components\stack\nwk\"  /
//                     -I "C:\Texas Instruments\ZAP-MSP430-2.5.0\Projects\zst /
//                     ack\ZAP\SE-SampleApp\EXP5438\..\..\..\..\..\Components /
//                     \stack\sapi\" -I "C:\Texas                             /
//                     Instruments\ZAP-MSP430-2.5.0\Projects\zstack\ZAP\SE-Sa /
//                     mpleApp\EXP5438\..\..\..\..\..\Components\stack\sec\"  /
//                     -I "C:\Texas Instruments\ZAP-MSP430-2.5.0\Projects\zst /
//                     ack\ZAP\SE-SampleApp\EXP5438\..\..\..\..\..\Components /
//                     \stack\sys\" -I "C:\Texas Instruments\ZAP-MSP430-2.5.0 /
//                     \Projects\zstack\ZAP\SE-SampleApp\EXP5438\..\..\..\..\ /
//                     ..\Components\stack\zcl\" -I "C:\Texas                 /
//                     Instruments\ZAP-MSP430-2.5.0\Projects\zstack\ZAP\SE-Sa /
//                     mpleApp\EXP5438\..\..\..\..\..\Components\stack\zdo\"  /
//                     -I "C:\Texas Instruments\ZAP-MSP430-2.5.0\Projects\zst /
//                     ack\ZAP\SE-SampleApp\EXP5438\..\..\..\..\..\Components /
//                     \zmac\" -I "C:\Texas Instruments\ZAP-MSP430-2.5.0\Proj /
//                     ects\zstack\ZAP\SE-SampleApp\EXP5438\..\..\..\..\..\Co /
//                     mponents\zmac\f8w\" --core=430X --data_model=small     /
//                     -Ohz --multiplier=32 --multiplier_location=4C0         /
//                     --require_prototypes --hw_workaround=CPU40             /
//    List file     =  C:\Texas Instruments\ZAP-MSP430-2.5.0\Projects\zstack\ /
//                     ZAP\SE-SampleApp\EXP5438\Simple Metering - End         /
//                     Device\List\simplemeter.s43                            /
//                                                                            /
//                                                                            /
///////////////////////////////////////////////////////////////////////////////

        NAME simplemeter

        RTMODEL "__SystemLibrary", "CLib"
        RTMODEL "__core", "430X"
        RTMODEL "__data_model", "small"
        RTMODEL "__double_size", "32"
        RTMODEL "__pic", "no"
        RTMODEL "__reg_r4", "free"
        RTMODEL "__reg_r5", "free"
        RTMODEL "__rt_version", "3"

        RSEG CSTACK:DATA:SORT:NOROOT(0)

        EXTERN ?CopyMemoryWords
        EXTERN ?cstart_init_copy
        EXTERN ?cstart_init_zero
        EXTERN ?longjmp_r4
        EXTERN ?longjmp_r5
        EXTERN ?setjmp_r4
        EXTERN ?setjmp_r5

        PUBWEAK ?setjmp_save_r4
        PUBWEAK ?setjmp_save_r5
        FUNCTION simplemeter_AlarmCB,0603H
        ARGFRAME CSTACK, 0, STACK
        LOCFRAME CSTACK, 4, STACK
        FUNCTION simplemeter_BasicResetCB,0603H
        ARGFRAME CSTACK, 0, STACK
        LOCFRAME CSTACK, 4, STACK
        FUNCTION simplemeter_GetProfileCmdCB,021603H
        ARGFRAME CSTACK, 0, STACK
        LOCFRAME CSTACK, 40, STACK
        FUNCTION simplemeter_GetProfileRspCB,0603H
        ARGFRAME CSTACK, 0, STACK
        LOCFRAME CSTACK, 4, STACK
        FUNCTION simplemeter_IdentifyCB,021603H
        ARGFRAME CSTACK, 0, STACK
        LOCFRAME CSTACK, 4, STACK
        FUNCTION simplemeter_IdentifyQueryRspCB,0603H
        ARGFRAME CSTACK, 0, STACK
        LOCFRAME CSTACK, 4, STACK
        PUBLIC simplemeter_Init
        FUNCTION simplemeter_Init,021203H
        ARGFRAME CSTACK, 0, STACK
        LOCFRAME CSTACK, 8, STACK
        FUNCTION simplemeter_MirrorRemCmdCB,0603H
        ARGFRAME CSTACK, 0, STACK
        LOCFRAME CSTACK, 4, STACK
        FUNCTION simplemeter_MirrorRemRspCB,0603H
        ARGFRAME CSTACK, 0, STACK
        LOCFRAME CSTACK, 4, STACK
        FUNCTION simplemeter_ProcessIdentifyTimeChange,021203H
        ARGFRAME CSTACK, 0, STACK
        LOCFRAME CSTACK, 4, STACK
        FUNCTION simplemeter_ProcessInConfigReportCmd,021203H
        ARGFRAME CSTACK, 0, STACK
        LOCFRAME CSTACK, 30, STACK
        FUNCTION simplemeter_ProcessInConfigReportRspCmd,021203H
        ARGFRAME CSTACK, 0, STACK
        LOCFRAME CSTACK, 20, STACK
        FUNCTION simplemeter_ProcessInReadReportCfgCmd,021203H
        ARGFRAME CSTACK, 0, STACK
        LOCFRAME CSTACK, 30, STACK
        FUNCTION simplemeter_ProcessZCLMsg,021203H
        ARGFRAME CSTACK, 0, STACK
        LOCFRAME CSTACK, 8, STACK
        FUNCTION simplemeter_ProcessZDOMsgs,021203H
        ARGFRAME CSTACK, 0, STACK
        LOCFRAME CSTACK, 8, STACK
        FUNCTION simplemeter_ReqMirrorCmdCB,0603H
        ARGFRAME CSTACK, 0, STACK
        LOCFRAME CSTACK, 4, STACK
        FUNCTION simplemeter_ReqMirrorRspCB,0603H
        ARGFRAME CSTACK, 0, STACK
        LOCFRAME CSTACK, 4, STACK
        FUNCTION simplemeter_ValidateAttrDataCB,0603H
        ARGFRAME CSTACK, 0, STACK
        LOCFRAME CSTACK, 4, STACK
        PUBLIC simplemeter_event_loop
        FUNCTION simplemeter_event_loop,021203H
        ARGFRAME CSTACK, 0, STACK
        LOCFRAME CSTACK, 18, STACK
        
          CFI Names cfiNames0
          CFI StackFrame CFA SP DATA
          CFI Resource PC:20, SP:20, SR:16, R4L:16, R4H:4, R4:20, R5L:16, R5H:4
          CFI Resource R5:20, R6L:16, R6H:4, R6:20, R7L:16, R7H:4, R7:20, R8L:16
          CFI Resource R8H:4, R8:20, R9L:16, R9H:4, R9:20, R10L:16, R10H:4
          CFI Resource R10:20, R11L:16, R11H:4, R11:20, R12L:16, R12H:4, R12:20
          CFI Resource R13L:16, R13H:4, R13:20, R14L:16, R14H:4, R14:20, R15L:16
          CFI Resource R15H:4, R15:20
          CFI ResourceParts R4 R4H, R4L
          CFI ResourceParts R5 R5H, R5L
          CFI ResourceParts R6 R6H, R6L
          CFI ResourceParts R7 R7H, R7L
          CFI ResourceParts R8 R8H, R8L
          CFI ResourceParts R9 R9H, R9L
          CFI ResourceParts R10 R10H, R10L
          CFI ResourceParts R11 R11H, R11L
          CFI ResourceParts R12 R12H, R12L
          CFI ResourceParts R13 R13H, R13L
          CFI ResourceParts R14 R14H, R14L
          CFI ResourceParts R15 R15H, R15L
          CFI EndNames cfiNames0
        
          CFI Common cfiCommon0 Using cfiNames0
          CFI CodeAlign 2
          CFI DataAlign 2
          CFI ReturnAddress PC CODE
          CFI CFA SP+4
          CFI PC Frame(CFA, -4)
          CFI SR Undefined
          CFI R4L SameValue
          CFI R4H 0
          CFI R4 Concat
          CFI R5L SameValue
          CFI R5H 0
          CFI R5 Concat
          CFI R6L SameValue
          CFI R6H 0
          CFI R6 Concat
          CFI R7L SameValue
          CFI R7H 0
          CFI R7 Concat
          CFI R8L SameValue
          CFI R8H 0
          CFI R8 Concat
          CFI R9L SameValue
          CFI R9H 0
          CFI R9 Concat
          CFI R10L SameValue
          CFI R10H 0
          CFI R10 Concat
          CFI R11L SameValue
          CFI R11H 0
          CFI R11 Concat
          CFI R12L Undefined
          CFI R12H Undefined
          CFI R12 Undefined
          CFI R13L Undefined
          CFI R13H Undefined
          CFI R13 Undefined
          CFI R14L Undefined
          CFI R14H Undefined
          CFI R14 Undefined
          CFI R15L Undefined
          CFI R15H Undefined
          CFI R15 Undefined
          CFI EndCommon cfiCommon0
        
        
          CFI Common cfiCommon1 Using cfiNames0
          CFI CodeAlign 2
          CFI DataAlign 2
          CFI ReturnAddress PC CODE
          CFI CFA SP+4
          CFI PC Frame(CFA, -4)
          CFI SR Undefined
          CFI R4L SameValue
          CFI R4H 0
          CFI R4 Concat
          CFI R5L SameValue
          CFI R5H 0
          CFI R5 Concat
          CFI R6L SameValue
          CFI R6H 0
          CFI R6 Concat
          CFI R7L SameValue
          CFI R7H 0
          CFI R7 Concat
          CFI R8L SameValue
          CFI R8H 0
          CFI R8 Concat
          CFI R9L SameValue
          CFI R9H 0
          CFI R9 Concat
          CFI R10L SameValue
          CFI R10H 0
          CFI R10 Concat
          CFI R11L SameValue
          CFI R11H 0
          CFI R11 Concat
          CFI R12L SameValue
          CFI R12H 0
          CFI R12 Concat
          CFI R13L SameValue
          CFI R13H 0
          CFI R13 Concat
          CFI R14L SameValue
          CFI R14H 0
          CFI R14 Concat
          CFI R15L SameValue
          CFI R15H 0
          CFI R15 Concat
          CFI EndCommon cfiCommon1
        
        EXTERN zclFindAttrRec
        FUNCTION zclFindAttrRec,0202H
        EXTERN zclAnalogDataType
        FUNCTION zclAnalogDataType,0202H
        EXTERN zclGetDataTypeLength
        FUNCTION zclGetDataTypeLength,0202H
        EXTERN osal_mem_alloc
        FUNCTION osal_mem_alloc,0202H
        EXTERN zcl_SendReadReportCfgRspCmd
        FUNCTION zcl_SendReadReportCfgRspCmd,0202H
        EXTERN osal_mem_free
        FUNCTION osal_mem_free,0202H
        EXTERN zcl_SendConfigReportRspCmd
        FUNCTION zcl_SendConfigReportRspCmd,0202H
        EXTERN zclSE_SimpleMetering_Send_GetProfileRsp
        FUNCTION zclSE_SimpleMetering_Send_GetProfileRsp,0202H
        EXTERN simpleMeterIdentifyTime
        EXTERN osal_start_timerEx
        FUNCTION osal_start_timerEx,0202H
        EXTERN HalLedBlink
        FUNCTION HalLedBlink,0202H
        EXTERN HalLedSet
        FUNCTION HalLedSet,0202H
        EXTERN osal_stop_timerEx
        FUNCTION osal_stop_timerEx,0202H
        EXTERN ZDO_ParseEPListRsp
        FUNCTION ZDO_ParseEPListRsp,0202H
        EXTERN osal_set_event
        FUNCTION osal_set_event,0202H
        EXTERN zclGeneral_KeyEstablish_InitiateKeyEstablishment
        FUNCTION zclGeneral_KeyEstablish_InitiateKeyEstablishment,0202H
        EXTERN osal_msg_deallocate
        FUNCTION osal_msg_deallocate,0202H
        EXTERN osal_msg_receive
        FUNCTION osal_msg_receive,0202H
        EXTERN ZDOInitDevice
        FUNCTION ZDOInitDevice,0202H
        EXTERN NLME_SetPollRate
        FUNCTION NLME_SetPollRate,0202H
        EXTERN zcl_SendReportCmd
        FUNCTION zcl_SendReportCmd,0202H
        EXTERN osal_getClock
        FUNCTION osal_getClock,0202H
        EXTERN simpleMeterTime
        EXTERN simpleMeterSimpleDesc
        EXTERN zclSE_Init
        FUNCTION zclSE_Init,0202H
        EXTERN zclGeneral_RegisterCmdCallbacks
        FUNCTION zclGeneral_RegisterCmdCallbacks,0202H
        EXTERN zclSE_RegisterCmdCallbacks
        FUNCTION zclSE_RegisterCmdCallbacks,0202H
        EXTERN simpleMeterAttrs
        EXTERN zcl_registerAttrList
        FUNCTION zcl_registerAttrList,0202H
        EXTERN simpleMeterOptions
        EXTERN zcl_registerClusterOptionList
        FUNCTION zcl_registerClusterOptionList,0202H
        EXTERN zcl_registerValidateAttrData
        FUNCTION zcl_registerValidateAttrData,0202H
        EXTERN zcl_registerForMsg
        FUNCTION zcl_registerForMsg,0202H
        EXTERN RegisterForKeys
        FUNCTION RegisterForKeys,0202H
        EXTERN ZDO_RegisterForZDOMsg
        FUNCTION ZDO_RegisterForZDOMsg,0202H
        EXTERN simpleMeterCurrentSummationDelivered

// C:\Texas Instruments\ZAP-MSP430-2.5.0\Projects\zstack\ZAP\SE-SampleApp\Source\SimpleMeter\simplemeter.c
//    1 /**************************************************************************************************
//    2   Filename:       simplemeter.c
//    3   Revised:        $Date: 2011-05-20 16:26:11 -0700 (Fri, 20 May 2011) $
//    4   Revision:       $Revision: 26054 $
//    5 
//    6   Description:    This module implements the Simple Meter functionality and
//    7                   contains the init and event loop functions
//    8 
//    9 
//   10   Copyright 2009-2011 Texas Instruments Incorporated. All rights reserved.
//   11 
//   12   IMPORTANT: Your use of this Software is limited to those specific rights
//   13   granted under the terms of a software license agreement between the user
//   14   who downloaded the software, his/her employer (which must be your employer)
//   15   and Texas Instruments Incorporated (the "License").  You may not use this
//   16   Software unless you agree to abide by the terms of the License. The License
//   17   limits your use, and you acknowledge, that the Software may not be modified,
//   18   copied or distributed unless embedded on a Texas Instruments microcontroller
//   19   or used solely and exclusively in conjunction with a Texas Instruments radio
//   20   frequency transceiver, which is integrated into your product.  Other than for
//   21   the foregoing purpose, you may not use, reproduce, copy, prepare derivative
//   22   works of, modify, distribute, perform, display or sell this Software and/or
//   23   its documentation for any purpose.
//   24 
//   25   YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
//   26   PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
//   27   INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
//   28   NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
//   29   TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
//   30   NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
//   31   LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
//   32   INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
//   33   OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
//   34   OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
//   35   (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
//   36 
//   37   Should you have any questions regarding your right to use this Software,
//   38   contact Texas Instruments Incorporated at www.TI.com.
//   39 **************************************************************************************************/
//   40 
//   41 /*********************************************************************
//   42   This application is designed for the test purpose of the SE profile which
//   43   exploits the following clusters for a Simple Metering configuration:
//   44 
//   45   General Basic
//   46   General Alarms
//   47   General Time
//   48   General Key Establishment
//   49   SE     Simple Metering
//   50 
//   51   Key control:
//   52     SW1:  Join Network
//   53     SW2:  N/A
//   54     SW3:  N/A
//   55     SW4:  N/A
//   56 
//   57 *********************************************************************/
//   58 
//   59 /*********************************************************************
//   60  * INCLUDES
//   61  */
//   62 
//   63 #include "OSAL.h"
//   64 #include "OSAL_Clock.h"
//   65 #include "OSAL_Nv.h"
//   66 #include "ZDApp.h"
//   67 #include "ZDObject.h"
//   68 #include "AddrMgr.h"
//   69 
//   70 #include "se.h"
//   71 #include "simplemeter.h"
//   72 #include "zcl_general.h"
//   73 #include "zcl_se.h"
//   74 #include "zcl_key_establish.h"
//   75 
//   76 #include "onboard.h"
//   77 
//   78 /* HAL */
//   79 #include "hal_lcd.h"
//   80 #include "hal_led.h"
//   81 #include "hal_key.h"
//   82 
//   83 
//   84 /*********************************************************************
//   85  * MACROS
//   86  */
//   87 
//   88 // There is no attribute in the Mandatory Reportable Attribute list for now
//   89 #define zcl_MandatoryReportableAttribute( a ) ( a == NULL )
//   90 
//   91 /*********************************************************************
//   92  * CONSTANTS
//   93  */
//   94 
//   95 #define SIMPLEMETER_MIN_REPORTING_INTERVAL       5
//   96 
//   97 /*********************************************************************
//   98  * TYPEDEFS
//   99  */
//  100 
//  101 /*********************************************************************
//  102  * GLOBAL VARIABLES
//  103  */
//  104 
//  105 /*********************************************************************
//  106  * GLOBAL FUNCTIONS
//  107  */
//  108 
//  109 /*********************************************************************
//  110  * LOCAL VARIABLES
//  111  */
//  112 

        RSEG DATA16_Z:DATA:SORT:NOROOT(0)
        REQUIRE ?cstart_init_zero
//  113 static uint8 simpleMeterTaskID;                                    // osal task id of simple meter
simpleMeterTaskID:
        DS8 1

        RSEG DATA16_Z:DATA:SORT:NOROOT(0)
        REQUIRE ?cstart_init_zero
//  114 static uint8 simpleMeterTransID;                                   // transaction id
simpleMeterTransID:
        DS8 1

        RSEG DATA16_Z:DATA:SORT:NOROOT(1)
        REQUIRE ?cstart_init_zero
//  115 static afAddrType_t ESPAddr;                                       // esp destination address
ESPAddr:
        DS8 12

        RSEG DATA16_Z:DATA:SORT:NOROOT(1)
        REQUIRE ?cstart_init_zero
//  116 static zclReportCmd_t *pReportCmd;                                 // report command structure
pReportCmd:
        DS8 2

        RSEG DATA16_I:DATA:SORT:NOROOT(0)
        REQUIRE ?cstart_init_copy
//  117 static uint8 numAttr = 1;                                          // number of attributes in report
numAttr:
        DS8 1
        REQUIRE `?<Initializer for numAttr>`
//  118 extern uint8 simpleMeterCurrentSummationDelivered[];               // defined in simplemeter_data.c
//  119 #if SECURE
//  120 static uint8 linkKeyStatus;                                        // status return from get link key routine
//  121 #endif
//  122 
//  123 /*********************************************************************
//  124  * LOCAL FUNCTIONS
//  125  */
//  126 static void simplemeter_HandleKeys( uint8 shift, uint8 keys );
//  127 
//  128 #if SECURE
//  129 static uint8 simplemeter_KeyEstablish_ReturnLinkKey( uint16 shortAddr );
//  130 #endif
//  131 
//  132 #if defined ( ZCL_ALARMS )
//  133 static void simplemeter_ProcessAlarmCmd( uint8 srcEP, afAddrType_t *dstAddr,
//  134                         uint16 clusterID, zclFrameHdr_t *hdr, uint8 len, uint8 *data );
//  135 #endif // ZCL_ALARMS
//  136 
//  137 static void simplemeter_ProcessIdentifyTimeChange( void );
//  138 
//  139 /*************************************************************************/
//  140 /*** Application Callback Functions                                    ***/
//  141 /*************************************************************************/
//  142 
//  143 // Foundation Callback functions
//  144 static uint8 simplemeter_ValidateAttrDataCB( zclAttrRec_t *pAttr, zclWriteRec_t *pAttrInfo );
//  145 
//  146 // General Cluster Callback functions
//  147 static void simplemeter_BasicResetCB( void );
//  148 static void simplemeter_IdentifyCB( zclIdentify_t *pCmd );
//  149 static void simplemeter_IdentifyQueryRspCB( zclIdentifyQueryRsp_t *pRsp );
//  150 static void simplemeter_AlarmCB( zclAlarm_t *pAlarm );
//  151 
//  152 // Function to process ZDO callback messages
//  153 static void simplemeter_ProcessZDOMsgs( zdoIncomingMsg_t *pMsg );
//  154 
//  155 // SE Callback functions
//  156 static void simplemeter_GetProfileCmdCB( zclCCGetProfileCmd_t *pCmd,
//  157                                        afAddrType_t *srcAddr, uint8 seqNum );
//  158 static void simplemeter_GetProfileRspCB( zclCCGetProfileRsp_t *pCmd,
//  159                                        afAddrType_t *srcAddr, uint8 seqNum );
//  160 static void simplemeter_ReqMirrorCmdCB( afAddrType_t *srcAddr, uint8 seqNum );
//  161 static void simplemeter_ReqMirrorRspCB( zclCCReqMirrorRsp_t *pCmd,
//  162                                        afAddrType_t *srcAddr, uint8 seqNum );
//  163 static void simplemeter_MirrorRemCmdCB( afAddrType_t *srcAddr, uint8 seqNum );
//  164 static void simplemeter_MirrorRemRspCB( zclCCMirrorRemRsp_t *pCmd,
//  165                                        afAddrType_t *srcAddr, uint8 seqNum );
//  166 
//  167 
//  168 /************************************************************************/
//  169 /***               Functions to process ZCL Foundation                ***/
//  170 /***               incoming Command/Response messages                 ***/
//  171 /************************************************************************/
//  172 static void simplemeter_ProcessZCLMsg( zclIncomingMsg_t *msg );
//  173 #if defined ( ZCL_READ )
//  174 static uint8 simplemeter_ProcessInReadRspCmd( zclIncomingMsg_t *pInMsg );
//  175 #endif // ZCL_READ
//  176 #if defined ( ZCL_WRITE )
//  177 static uint8 simplemeter_ProcessInWriteRspCmd( zclIncomingMsg_t *pInMsg );
//  178 #endif // ZCL_WRITE
//  179 #if defined ( ZCL_REPORT )
//  180 static uint8 simplemeter_ProcessInConfigReportCmd( zclIncomingMsg_t *pInMsg );
//  181 static uint8 simplemeter_ProcessInConfigReportRspCmd( zclIncomingMsg_t *pInMsg );
//  182 static uint8 simplemeter_ProcessInReadReportCfgCmd( zclIncomingMsg_t *pInMsg );
//  183 static uint8 simplemeter_ProcessInReadReportCfgRspCmd( zclIncomingMsg_t *pInMsg );
//  184 static uint8 simplemeter_ProcessInReportCmd( zclIncomingMsg_t *pInMsg );
//  185 #endif // ZCL_REPORT
//  186 static uint8 simplemeter_ProcessInDefaultRspCmd( zclIncomingMsg_t *pInMsg );
//  187 #if defined ( ZCL_DISCOVER )
//  188 static uint8 simplemeter_ProcessInDiscRspCmd( zclIncomingMsg_t *pInMsg );
//  189 #endif // ZCL_DISCOVER
//  190 
//  191 /*********************************************************************
//  192  * ZCL General Clusters Callback table
//  193  */

        RSEG DATA16_I:DATA:SORT:NOROOT(1)
        REQUIRE ?cstart_init_copy
//  194 static zclGeneral_AppCallbacks_t simplemeter_GenCmdCallbacks =
simplemeter_GenCmdCallbacks:
        DS8 60
        REQUIRE `?<Initializer for simplemeter_GenCmdCallbacks>`
//  195 {
//  196   simplemeter_BasicResetCB,              // Basic Cluster Reset command
//  197   simplemeter_IdentifyCB,                // Identify command
//  198   simplemeter_IdentifyQueryRspCB,        // Identify Query Response command
//  199   NULL,                                  // On/Off cluster commands
//  200   NULL,                                  // Level Control Move to Level command
//  201   NULL,                                  // Level Control Move command
//  202   NULL,                                  // Level Control Step command
//  203   NULL,                                  // Level Control Stop command
//  204   NULL,                                  // Group Response commands
//  205   NULL,                                  // Scene Store Request command
//  206   NULL,                                  // Scene Recall Request command
//  207   NULL,                                  // Scene Response command
//  208   simplemeter_AlarmCB,                   // Alarm (Response) command
//  209   NULL,                                  // RSSI Location command
//  210   NULL                                   // RSSI Location Response command
//  211 };
//  212 
//  213 /*********************************************************************
//  214  * ZCL SE Clusters Callback table
//  215  */

        RSEG DATA16_I:DATA:SORT:NOROOT(1)
        REQUIRE ?cstart_init_copy
//  216 static zclSE_AppCallbacks_t simplemeter_SECmdCallbacks =			
simplemeter_SECmdCallbacks:
        DS8 104
        REQUIRE `?<Initializer for simplemeter_SECmdCallbacks>`
//  217 {
//  218   simplemeter_GetProfileCmdCB,                        // Get Profile Command
//  219   simplemeter_GetProfileRspCB,                        // Get Profile Response
//  220   simplemeter_ReqMirrorCmdCB,                         // Request Mirror Command
//  221   simplemeter_ReqMirrorRspCB,                         // Request Mirror Response
//  222   simplemeter_MirrorRemCmdCB,                         // Mirror Remove Command
//  223   simplemeter_MirrorRemRspCB,                         // Mirror Remove Response
//  224   NULL,                                               // Get Current Price
//  225   NULL,                                               // Get Scheduled Price
//  226   NULL,                                               // Publish Price
//  227   NULL,                                               // Display Message Command
//  228   NULL,                                               // Cancel Message Command
//  229   NULL,                                               // Get Last Message Command
//  230   NULL,                                               // Message Confirmation
//  231   NULL,                                               // Load Control Event
//  232   NULL,                                               // Cancel Load Control Event
//  233   NULL,                                               // Cancel All Load Control Events
//  234   NULL,                                               // Report Event Status
//  235   NULL,                                               // Get Scheduled Event
//  236   NULL,                                               // Request Fast Poll Mode Command
//  237   NULL,                                               // Request Fast Poll Mode Response
//  238   NULL,                                               // Price Acknowledgement
//  239   NULL,                                               // Get Block Period
//  240   NULL,                                               // Publish Block Period
//  241   NULL,                                               // Select Available Emergency Credit Command
//  242   NULL,                                               // Change Supply Command
//  243   NULL                                                // Supply Status Response
//  244 };
//  245 
//  246 /*********************************************************************
//  247  * @fn          simplemeter_Init
//  248  *
//  249  * @brief       Initialization function for the ZCL App Application.
//  250  *
//  251  * @param       uint8 task_id - simple meter task id
//  252  *
//  253  * @return      none
//  254  */

        RSEG CODE:CODE:REORDER:NOROOT(1)
//  255 void simplemeter_Init( uint8 task_id )
simplemeter_Init:
          CFI Block cfiBlock0 Using cfiCommon0
          CFI Function simplemeter_Init
//  256 {
        FUNCALL simplemeter_Init, zclSE_Init
        LOCFRAME CSTACK, 8, STACK
        FUNCALL simplemeter_Init, zclGeneral_RegisterCmdCallbacks
        LOCFRAME CSTACK, 8, STACK
        FUNCALL simplemeter_Init, zclSE_RegisterCmdCallbacks
        LOCFRAME CSTACK, 8, STACK
        FUNCALL simplemeter_Init, zcl_registerAttrList
        LOCFRAME CSTACK, 8, STACK
        FUNCALL simplemeter_Init, zcl_registerClusterOptionList
        LOCFRAME CSTACK, 8, STACK
        FUNCALL simplemeter_Init, zcl_registerValidateAttrData
        LOCFRAME CSTACK, 8, STACK
        FUNCALL simplemeter_Init, zcl_registerForMsg
        LOCFRAME CSTACK, 8, STACK
        FUNCALL simplemeter_Init, RegisterForKeys
        LOCFRAME CSTACK, 8, STACK
        FUNCALL simplemeter_Init, ZDO_RegisterForZDOMsg
        LOCFRAME CSTACK, 8, STACK
        FUNCALL simplemeter_Init, osal_start_timerEx
        LOCFRAME CSTACK, 8, STACK
        FUNCALL simplemeter_Init, osal_mem_alloc
        LOCFRAME CSTACK, 8, STACK
        PUSHM.W #0x2, R11
          CFI R10L Frame(CFA, -8)
          CFI R11L Frame(CFA, -6)
          CFI CFA SP+8
        MOV.B   R12, R10
//  257   simpleMeterTaskID = task_id;
        MOV.B   R12, &simpleMeterTaskID
//  258   simpleMeterTransID = 0;
        MOV.B   #0x0, &simpleMeterTransID
//  259 
//  260   // Device hardware initialization can be added here or in main() (Zmain.c).
//  261   // If the hardware is application specific - add it here.
//  262   // If the hardware is other parts of the device add it in main().
//  263 
//  264   // ESP destination address init
//  265   ESPAddr.addrMode = (afAddrMode_t)Addr16Bit;
        MOV.B   #0x2, &ESPAddr + 8
//  266   ESPAddr.endPoint = SIMPLEMETER_ENDPOINT;
        MOV.B   #0x9, R11
        MOV.B   R11, &ESPAddr + 9
//  267   ESPAddr.addr.shortAddr = 0;
        MOV.W   #0x0, &ESPAddr
//  268 
//  269   // register for SE endpoint
//  270   zclSE_Init( &simpleMeterSimpleDesc );
        MOV.W   #simpleMeterSimpleDesc, R12
        CALLA   #zclSE_Init
//  271 
//  272   // Register the ZCL General Cluster Library callback functions
//  273   zclGeneral_RegisterCmdCallbacks( SIMPLEMETER_ENDPOINT, &simplemeter_GenCmdCallbacks );
        MOV.W   #simplemeter_GenCmdCallbacks, R13
        MOV.B   R11, R12
        CALLA   #zclGeneral_RegisterCmdCallbacks
//  274 
//  275   // Register the ZCL SE Cluster Library callback functions
//  276   zclSE_RegisterCmdCallbacks( SIMPLEMETER_ENDPOINT, &simplemeter_SECmdCallbacks );
        MOV.W   #simplemeter_SECmdCallbacks, R13
        MOV.B   R11, R12
        CALLA   #zclSE_RegisterCmdCallbacks
//  277 
//  278   // Register the application's attribute list
//  279   zcl_registerAttrList( SIMPLEMETER_ENDPOINT, SIMPLEMETER_MAX_ATTRIBUTES, simpleMeterAttrs );
        MOV.W   #simpleMeterAttrs, R14
        MOV.B   #0x36, R13
        MOV.B   R11, R12
        CALLA   #zcl_registerAttrList
//  280 
//  281   // Register the application's cluster option list
//  282   zcl_registerClusterOptionList( SIMPLEMETER_ENDPOINT, SIMPLEMETER_MAX_OPTIONS, simpleMeterOptions );
        MOV.W   #simpleMeterOptions, R14
        MOV.B   #0x2, R13
        MOV.B   R11, R12
        CALLA   #zcl_registerClusterOptionList
//  283 
//  284   // Register the application's attribute data validation callback function
//  285   zcl_registerValidateAttrData( simplemeter_ValidateAttrDataCB );
        MOV.W   #LWRD(simplemeter_ValidateAttrDataCB), R12
        MOV.W   #HWRD(simplemeter_ValidateAttrDataCB), R13
        CALLA   #zcl_registerValidateAttrData
//  286 
//  287   // Register the Application to receive the unprocessed Foundation command/response messages
//  288   zcl_registerForMsg( simpleMeterTaskID );
        MOV.B   &simpleMeterTaskID, R12
        CALLA   #zcl_registerForMsg
//  289 
//  290   // Register for all key events - This app will handle all key events
//  291   RegisterForKeys( simpleMeterTaskID );
        MOV.B   &simpleMeterTaskID, R12
        CALLA   #RegisterForKeys
//  292 
//  293   // Register with the ZDO to receive Match Descriptor Responses
//  294   ZDO_RegisterForZDOMsg(task_id, Match_Desc_rsp);
        MOV.W   #0x8006, R13
        MOV.B   R10, R12
        CALLA   #ZDO_RegisterForZDOMsg
//  295 
//  296   // Start the timer to sync SimpleMeter timer with the osal timer
//  297   osal_start_timerEx( simpleMeterTaskID, SIMPLEMETER_UPDATE_TIME_EVT, SIMPLEMETER_UPDATE_TIME_PERIOD );
        MOV.W   #0x3e8, R14
        MOV.W   #0x2, R13
        MOV.B   &simpleMeterTaskID, R12
        CALLA   #osal_start_timerEx
//  298 
//  299   // setup attribute IDs of interest for Simple Meter
//  300 
//  301   pReportCmd = (zclReportCmd_t *)osal_mem_alloc( sizeof( zclReportCmd_t ) + ( numAttr * sizeof( zclReport_t ) ) );
        MOV.B   &numAttr, R15
        MOV.W   #0x2, R12
        RPT     #0x6
        ADDX.W  R15, R12
        CALLA   #osal_mem_alloc
        MOV.W   R12, &pReportCmd
//  302   if ( pReportCmd != NULL )
        CMP.W   #0x0, R12
        JEQ     ??simplemeter_Init_0
//  303   {
//  304     pReportCmd->numAttr = numAttr;
        MOV.B   &numAttr, 0(R12)
//  305 
//  306     // Set up the first attribute
//  307     pReportCmd->attrList[0].attrID = ATTRID_SE_CURRENT_SUMMATION_DELIVERED;
        MOV.W   #0x0, 0x2(R12)
//  308     pReportCmd->attrList[0].dataType = ZCL_DATATYPE_UINT48;
        MOV.B   #0x25, 0x4(R12)
//  309     pReportCmd->attrList[0].attrData = simpleMeterCurrentSummationDelivered;
        MOV.W   #simpleMeterCurrentSummationDelivered, 0x6(R12)
//  310 
//  311     // Set up the remaining attributes
//  312   }
//  313 }
??simplemeter_Init_0:
        POPM.W  #0x2, R11
          CFI R10L SameValue
          CFI R11L SameValue
          CFI CFA SP+4
        RETA
          CFI EndBlock cfiBlock0
//  314 
//  315 /*********************************************************************
//  316  * @fn          simplemeter_event_loop
//  317  *
//  318  * @brief       Event Loop Processor for the simple meter.
//  319  *
//  320  * @param       uint8 task_id - the osal task id
//  321  * @param       uint16 events - the event bitmask
//  322  *
//  323  * @return      none
//  324  */

        RSEG CODE:CODE:REORDER:NOROOT(1)
//  325 uint16 simplemeter_event_loop( uint8 task_id, uint16 events )
simplemeter_event_loop:
          CFI Block cfiBlock1 Using cfiCommon0
          CFI Function simplemeter_event_loop
//  326 {
        FUNCALL simplemeter_event_loop, zclGeneral_KeyEstablish_InitiateKeyEstablishment
        LOCFRAME CSTACK, 12, STACK
        FUNCALL simplemeter_event_loop, osal_start_timerEx
        LOCFRAME CSTACK, 12, STACK
        FUNCALL simplemeter_event_loop, osal_msg_deallocate
        LOCFRAME CSTACK, 12, STACK
        FUNCALL simplemeter_event_loop, osal_msg_receive
        LOCFRAME CSTACK, 12, STACK
        FUNCALL simplemeter_event_loop, simplemeter_ProcessZDOMsgs
        LOCFRAME CSTACK, 12, STACK
        FUNCALL simplemeter_event_loop, simplemeter_ProcessZCLMsg
        LOCFRAME CSTACK, 12, STACK
        FUNCALL simplemeter_event_loop, ZDOInitDevice
        LOCFRAME CSTACK, 12, STACK
        FUNCALL simplemeter_event_loop, osal_start_timerEx
        LOCFRAME CSTACK, 12, STACK
        FUNCALL simplemeter_event_loop, NLME_SetPollRate
        LOCFRAME CSTACK, 12, STACK
        FUNCALL simplemeter_event_loop, zcl_SendReportCmd
        LOCFRAME CSTACK, 18, STACK
        FUNCALL simplemeter_event_loop, osal_start_timerEx
        LOCFRAME CSTACK, 18, STACK
        FUNCALL simplemeter_event_loop, simplemeter_ProcessIdentifyTimeChange
        LOCFRAME CSTACK, 12, STACK
        FUNCALL simplemeter_event_loop, osal_getClock
        LOCFRAME CSTACK, 12, STACK
        FUNCALL simplemeter_event_loop, osal_start_timerEx
        LOCFRAME CSTACK, 12, STACK
        PUSHM.W #0x4, R11
          CFI R8L Frame(CFA, -12)
          CFI R9L Frame(CFA, -10)
          CFI R10L Frame(CFA, -8)
          CFI R11L Frame(CFA, -6)
          CFI CFA SP+12
        MOV.W   R13, R10
        MOV.W   #simpleMeterTaskID, R11
        CMP.W   #0x0, R13
        JL      ??simplemeter_event_loop_4
//  327   afIncomingMSGPacket_t *MSGpkt;
//  328 
//  329   if ( events & SYS_EVENT_MSG )
//  330   {
//  331     while ( (MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( simpleMeterTaskID )) )
//  332     {
//  333       switch ( MSGpkt->hdr.event )
//  334       {
//  335         case ZDO_CB_MSG:
//  336           simplemeter_ProcessZDOMsgs( (zdoIncomingMsg_t *)MSGpkt );
//  337           break;
//  338 
//  339         case ZCL_INCOMING_MSG:
//  340           // Incoming ZCL foundation command/response messages
//  341           simplemeter_ProcessZCLMsg( (zclIncomingMsg_t *)MSGpkt );
//  342           break;
//  343 
//  344         case KEY_CHANGE:
//  345           simplemeter_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
//  346           break;
//  347 
//  348         case ZDO_STATE_CHANGE:
//  349           if ((DEV_END_DEVICE == (devStates_t)(MSGpkt->hdr.status)) ||
//  350               (DEV_ROUTER == (devStates_t)(MSGpkt->hdr.status)))
//  351           {
//  352 #if SECURE
//  353             {
//  354               // check to see if link key had already been established
//  355               linkKeyStatus = simplemeter_KeyEstablish_ReturnLinkKey(ESPAddr.addr.shortAddr);
//  356 
//  357               if (linkKeyStatus != ZSuccess)
//  358               {
//  359                 cId_t cbkeCluster = ZCL_CLUSTER_ID_GEN_KEY_ESTABLISHMENT;
//  360                 zAddrType_t dstAddr;
//  361 
//  362                 // Send out a match for the key establishment
//  363                 dstAddr.addrMode = AddrBroadcast;
//  364                 dstAddr.addr.shortAddr = NWK_BROADCAST_SHORTADDR;
//  365                 ZDP_MatchDescReq( &dstAddr, NWK_BROADCAST_SHORTADDR, ZCL_SE_PROFILE_ID,
//  366                                   1, &cbkeCluster, 0, NULL, FALSE );
//  367               }
//  368               else
//  369               {
//  370                 // link key already established, resume sending reports
//  371                 osal_start_timerEx( simpleMeterTaskID, SIMPLEMETER_REPORT_ATTRIBUTE_EVT,
//  372                                                        SIMPLEMETER_REPORT_PERIOD );
//  373               }
//  374             }
//  375 #else
//  376             {
//  377               osal_start_timerEx( simpleMeterTaskID, SIMPLEMETER_REPORT_ATTRIBUTE_EVT,
//  378                                                      SIMPLEMETER_REPORT_PERIOD );
//  379             }
//  380 #endif
//  381             // per smart energy spec end device polling requirement of not to poll < 7.5 seconds
//  382             NLME_SetPollRate ( SE_DEVICE_POLL_RATE );
//  383           }
//  384           break;
//  385 
//  386 #if defined( ZCL_KEY_ESTABLISH )
//  387         case ZCL_KEY_ESTABLISH_IND:
//  388           if ((MSGpkt->hdr.status) == TermKeyStatus_Success)
//  389           {
//  390             ESPAddr.endPoint = SIMPLEMETER_ENDPOINT; // set destination endpoint back to application endpoint
//  391             osal_start_timerEx( simpleMeterTaskID, SIMPLEMETER_REPORT_ATTRIBUTE_EVT, SIMPLEMETER_REPORT_PERIOD );
//  392           }
//  393 
//  394           break;
//  395 #endif
//  396 
//  397         default:
//  398           break;
//  399       }
//  400 
//  401       // Release the memory
//  402       osal_msg_deallocate( (uint8 *)MSGpkt );
//  403 
//  404     }
//  405 
//  406     // return unprocessed events
//  407     return (events ^ SYS_EVENT_MSG);
//  408   }
//  409 
//  410   // event to intiate key establishment request
//  411   if ( events & SIMPLEMETER_KEY_ESTABLISHMENT_REQUEST_EVT )
        BIT.W   #0x4, R13
        JNC     ??simplemeter_event_loop_5
//  412   {
//  413     zclGeneral_KeyEstablish_InitiateKeyEstablishment(simpleMeterTaskID, &ESPAddr, simpleMeterTransID);
        MOV.B   &simpleMeterTransID, R14
        MOV.W   #ESPAddr, R13
        MOV.B   @R11, R12
        CALLA   #zclGeneral_KeyEstablish_InitiateKeyEstablishment
//  414 
//  415     return ( events ^ SIMPLEMETER_KEY_ESTABLISHMENT_REQUEST_EVT );
        XOR.W   #0x4, R10
        JMP     ??simplemeter_event_loop_3
//  416   }
??simplemeter_event_loop_0:
        CMP.B   #0x0, 0x1(R12)
        JNE     ??simplemeter_event_loop_1
        MOV.B   #0x9, &ESPAddr + 9
        CALLA   #?Subroutine2
??simplemeter_event_loop_1:
        MOV.W   R8, R12
        CALLA   #osal_msg_deallocate
??simplemeter_event_loop_4:
        MOV.B   @R11, R12
        CALLA   #osal_msg_receive
        MOV.W   R12, R8
        CMP.W   #0x0, R12
        JEQ     ??simplemeter_event_loop_6
        MOV.B   @R12, R14
        SUB.B   #0x34, R14
        JEQ     ??simplemeter_event_loop_7
        SUB.B   #0x1, R14
        JEQ     ??simplemeter_event_loop_0
        SUB.B   #0x8b, R14
        JEQ     ??simplemeter_event_loop_8
        SUB.B   #0x11, R14
        JEQ     ??simplemeter_event_loop_9
        SUB.B   #0x2, R14
        JNE     ??simplemeter_event_loop_1
        CALLA   #simplemeter_ProcessZDOMsgs
        JMP     ??simplemeter_event_loop_1
??simplemeter_event_loop_7:
        CALLA   #simplemeter_ProcessZCLMsg
        JMP     ??simplemeter_event_loop_1
??simplemeter_event_loop_8:
        CMP.B   #0x0, 0x2(R12)
        JNE     ??simplemeter_event_loop_1
        BIT.B   #0x1, 0x3(R12)
        JNC     ??simplemeter_event_loop_1
        MOV.W   #0x0, R12
        CALLA   #ZDOInitDevice
        JMP     ??simplemeter_event_loop_1
??simplemeter_event_loop_9:
        MOV.B   0x1(R12), R14
        CMP.B   #0x6, R14
        JEQ     ??simplemeter_event_loop_10
        CMP.B   #0x7, R14
        JNE     ??simplemeter_event_loop_1
??simplemeter_event_loop_10:
        CALLA   #?Subroutine2
??CrossCallReturnLabel_1:
        MOV.W   #0x1f40, R12
        CALLA   #NLME_SetPollRate
        JMP     ??simplemeter_event_loop_1
??simplemeter_event_loop_6:
        XOR.W   #0x8000, R10
        JMP     ??simplemeter_event_loop_3
//  417 
//  418   // event to send report attribute
//  419   if ( events & SIMPLEMETER_REPORT_ATTRIBUTE_EVT )
??simplemeter_event_loop_5:
        BIT.W   #0x8, R13
        JNC     ??simplemeter_event_loop_11
//  420   {
//  421     if ( pReportCmd != NULL )
        CMP.W   #0x0, &pReportCmd
        JEQ     ??simplemeter_event_loop_12
//  422     {
//  423       zcl_SendReportCmd( SIMPLEMETER_ENDPOINT, &ESPAddr,
//  424                          ZCL_CLUSTER_ID_SE_SIMPLE_METERING, pReportCmd,
//  425                          ZCL_FRAME_SERVER_CLIENT_DIR, 1, 0 );
        PUSH.B  #0x0
          CFI CFA SP+14
        PUSH.B  #0x1
          CFI CFA SP+16
        PUSH.B  #0x1
          CFI CFA SP+18
        MOV.W   &pReportCmd, R15
        MOV.W   #0x702, R14
        MOV.W   #ESPAddr, R13
        MOV.B   #0x9, R12
        CALLA   #zcl_SendReportCmd
//  426 
//  427       osal_start_timerEx( simpleMeterTaskID, SIMPLEMETER_REPORT_ATTRIBUTE_EVT, SIMPLEMETER_REPORT_PERIOD );
        CALLA   #?Subroutine2
//  428     }
??CrossCallReturnLabel_0:
        ADD.W   #0x6, SP
          CFI CFA SP+12
//  429 
//  430     return ( events ^ SIMPLEMETER_REPORT_ATTRIBUTE_EVT );
??simplemeter_event_loop_12:
        XOR.W   #0x8, R10
        JMP     ??simplemeter_event_loop_3
//  431   }
//  432 
//  433   // handle processing of identify timeout event triggered by an identify command
//  434   if ( events & SIMPLEMETER_IDENTIFY_TIMEOUT_EVT )
??simplemeter_event_loop_11:
        BIT.W   #0x1, R13
        JNC     ??simplemeter_event_loop_13
//  435   {
//  436     if ( simpleMeterIdentifyTime > 0 )
        CMP.W   #0x0, &simpleMeterIdentifyTime
        JEQ     ??simplemeter_event_loop_14
//  437     {
//  438       simpleMeterIdentifyTime--;
        ADD.W   #0xffff, &simpleMeterIdentifyTime
//  439     }
//  440     simplemeter_ProcessIdentifyTimeChange();
??simplemeter_event_loop_14:
        CALLA   #simplemeter_ProcessIdentifyTimeChange
//  441 
//  442     return ( events ^ SIMPLEMETER_IDENTIFY_TIMEOUT_EVT );
        XOR.W   #0x1, R10
        JMP     ??simplemeter_event_loop_3
//  443   }
//  444 
//  445   // event to get current time
//  446   if ( events & SIMPLEMETER_UPDATE_TIME_EVT )
??simplemeter_event_loop_13:
        BIT.W   #0x2, R13
        JNC     ??simplemeter_event_loop_15
//  447   {
//  448     simpleMeterTime = osal_getClock();
        CALLA   #osal_getClock
        MOV.W   R12, &simpleMeterTime
        MOV.W   R13, &simpleMeterTime + 2
//  449     osal_start_timerEx( simpleMeterTaskID, SIMPLEMETER_UPDATE_TIME_EVT, SIMPLEMETER_UPDATE_TIME_PERIOD );
        MOV.W   #0x3e8, R14
        MOV.W   #0x2, R13
        MOV.B   @R11, R12
        CALLA   #osal_start_timerEx
//  450 
//  451     return ( events ^ SIMPLEMETER_UPDATE_TIME_EVT );
        XOR.W   #0x2, R10
??simplemeter_event_loop_3:
        MOV.W   R10, R12
        JMP     ??simplemeter_event_loop_16
//  452   }
//  453 
//  454   // Discard unknown events
//  455   return 0;
??simplemeter_event_loop_15:
        MOV.W   #0x0, R12
??simplemeter_event_loop_16:
        POPM.W  #0x4, R11
          CFI R10L SameValue
          CFI R11L SameValue
          CFI R8L SameValue
          CFI R9L SameValue
          CFI CFA SP+4
        RETA
          CFI EndBlock cfiBlock1
//  456 }

        RSEG CODE:CODE:REORDER:NOROOT(1)
?Subroutine2:
          CFI Block cfiCond2 Using cfiCommon0
          CFI Function simplemeter_event_loop
          CFI Conditional ??simplemeter_event_loop_1
          CFI R8L Frame(CFA, -12)
          CFI R9L Frame(CFA, -10)
          CFI R10L Frame(CFA, -8)
          CFI R11L Frame(CFA, -6)
          CFI CFA SP+16
          CFI Block cfiCond3 Using cfiCommon0
          CFI (cfiCond3) Function simplemeter_event_loop
          CFI (cfiCond3) Conditional ??CrossCallReturnLabel_1
          CFI (cfiCond3) R8L Frame(CFA, -12)
          CFI (cfiCond3) R9L Frame(CFA, -10)
          CFI (cfiCond3) R10L Frame(CFA, -8)
          CFI (cfiCond3) R11L Frame(CFA, -6)
          CFI (cfiCond3) CFA SP+16
          CFI Block cfiCond4 Using cfiCommon0
          CFI (cfiCond4) Function simplemeter_event_loop
          CFI (cfiCond4) Conditional ??CrossCallReturnLabel_0
          CFI (cfiCond4) R8L Frame(CFA, -12)
          CFI (cfiCond4) R9L Frame(CFA, -10)
          CFI (cfiCond4) R10L Frame(CFA, -8)
          CFI (cfiCond4) R11L Frame(CFA, -6)
          CFI (cfiCond4) CFA SP+22
          CFI Block cfiPicker5 Using cfiCommon1
          CFI (cfiPicker5) NoFunction
          CFI (cfiPicker5) Picker
        MOV.W   #0x1388, R14
        MOV.W   #0x8, R13
        MOV.B   @R11, R12
        BRA     #osal_start_timerEx
          CFI EndBlock cfiCond2
          CFI EndBlock cfiCond3
          CFI EndBlock cfiCond4
          CFI EndBlock cfiPicker5
//  457 
//  458 /*********************************************************************
//  459  * @fn      simplemeter_ProcessZDOMsgs
//  460  *
//  461  * @brief   Called to process callbacks from the ZDO.
//  462  *
//  463  * @param   none
//  464  *
//  465  * @return  none
//  466  */

        RSEG CODE:CODE:REORDER:NOROOT(1)
//  467 static void simplemeter_ProcessZDOMsgs( zdoIncomingMsg_t *pMsg )
simplemeter_ProcessZDOMsgs:
          CFI Block cfiBlock6 Using cfiCommon0
          CFI Function simplemeter_ProcessZDOMsgs
//  468 {
        FUNCALL simplemeter_ProcessZDOMsgs, ZDO_ParseEPListRsp
        LOCFRAME CSTACK, 8, STACK
        FUNCALL simplemeter_ProcessZDOMsgs, osal_set_event
        LOCFRAME CSTACK, 8, STACK
        FUNCALL simplemeter_ProcessZDOMsgs, osal_mem_free
        LOCFRAME CSTACK, 8, STACK
        PUSHM.W #0x2, R11
          CFI R10L Frame(CFA, -8)
          CFI R11L Frame(CFA, -6)
          CFI CFA SP+8
        MOV.W   R12, R10
//  469   if (pMsg->clusterID == Match_Desc_rsp)
        CMP.W   #0x8006, 0xe(R12)
        JNE     ??simplemeter_ProcessZDOMsgs_0
//  470   {
//  471     ZDO_ActiveEndpointRsp_t *pRsp = ZDO_ParseEPListRsp( pMsg );
        CALLA   #ZDO_ParseEPListRsp
        MOV.W   R12, R11
//  472 
//  473     if (pRsp)
        CMP.W   #0x0, R12
        JEQ     ??simplemeter_ProcessZDOMsgs_0
//  474     {
//  475       if (pRsp->cnt)
        CMP.B   #0x0, 0x4(R12)
        JEQ     ??simplemeter_ProcessZDOMsgs_1
//  476       {
//  477         // Record the trust center
//  478         ESPAddr.endPoint = pRsp->epList[0];
        MOV.B   0x5(R12), &ESPAddr + 9
//  479         ESPAddr.addr.shortAddr = pMsg->srcAddr.addr.shortAddr;
        MOV.W   0x2(R10), &ESPAddr
//  480 
//  481         // send out key establishment request
//  482         osal_set_event( simpleMeterTaskID, SIMPLEMETER_KEY_ESTABLISHMENT_REQUEST_EVT);
        MOV.W   #0x4, R13
        MOV.B   &simpleMeterTaskID, R12
        CALLA   #osal_set_event
//  483       }
//  484       osal_mem_free(pRsp);
??simplemeter_ProcessZDOMsgs_1:
        MOV.W   R11, R12
        CALLA   #osal_mem_free
//  485     }
//  486   }
//  487 }
??simplemeter_ProcessZDOMsgs_0:
        POPM.W  #0x2, R11
          CFI R10L SameValue
          CFI R11L SameValue
          CFI CFA SP+4
        RETA
          CFI EndBlock cfiBlock6
//  488 
//  489 /*********************************************************************
//  490  * @fn      simplemeter_ProcessIdentifyTimeChange
//  491  *
//  492  * @brief   Called to blink led for specified IdentifyTime attribute value
//  493  *
//  494  * @param   none
//  495  *
//  496  * @return  none
//  497  */

        RSEG CODE:CODE:REORDER:NOROOT(1)
//  498 static void simplemeter_ProcessIdentifyTimeChange( void )
simplemeter_ProcessIdentifyTimeChange:
          CFI Block cfiBlock7 Using cfiCommon0
          CFI Function simplemeter_ProcessIdentifyTimeChange
//  499 {
//  500   if ( simpleMeterIdentifyTime > 0 )
        FUNCALL simplemeter_ProcessIdentifyTimeChange, osal_start_timerEx
        LOCFRAME CSTACK, 4, STACK
        FUNCALL simplemeter_ProcessIdentifyTimeChange, HalLedBlink
        LOCFRAME CSTACK, 4, STACK
        FUNCALL simplemeter_ProcessIdentifyTimeChange, HalLedSet
        LOCFRAME CSTACK, 4, STACK
        FUNCALL simplemeter_ProcessIdentifyTimeChange, osal_stop_timerEx
        LOCFRAME CSTACK, 4, STACK
        CMP.W   #0x0, &simpleMeterIdentifyTime
        JEQ     ??simplemeter_ProcessIdentifyTimeChange_0
//  501   {
//  502     osal_start_timerEx( simpleMeterTaskID, SIMPLEMETER_IDENTIFY_TIMEOUT_EVT, 1000 );
        MOV.W   #0x3e8, R14
        MOV.W   #0x1, R13
        MOV.B   &simpleMeterTaskID, R12
        CALLA   #osal_start_timerEx
//  503     HalLedBlink ( HAL_LED_4, 0xFF, HAL_LED_DEFAULT_DUTY_CYCLE, HAL_LED_DEFAULT_FLASH_TIME );
        MOV.W   #0x3e8, R15
        MOV.B   #0x5, R14
        MOV.B   #0xff, R13
        MOV.B   #0x8, R12
        BRA     #HalLedBlink
//  504   }
//  505   else
//  506   {
//  507     HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
??simplemeter_ProcessIdentifyTimeChange_0:
        MOV.B   #0x0, R13
        MOV.B   #0x8, R12
        CALLA   #HalLedSet
//  508     osal_stop_timerEx( simpleMeterTaskID, SIMPLEMETER_IDENTIFY_TIMEOUT_EVT );
        MOV.W   #0x1, R13
        MOV.B   &simpleMeterTaskID, R12
        BRA     #osal_stop_timerEx
          CFI EndBlock cfiBlock7
//  509   }
//  510 }
//  511 
//  512 #if SECURE
//  513 /*********************************************************************
//  514  * @fn      simplemeter_KeyEstablish_ReturnLinkKey
//  515  *
//  516  * @brief   This function get the requested link key
//  517  *
//  518  * @param   shortAddr - short address of the partner.
//  519  *
//  520  * @return  none
//  521  */
//  522 static uint8 simplemeter_KeyEstablish_ReturnLinkKey( uint16 shortAddr )
//  523 {
//  524   uint8 status = ZFailure;
//  525   AddrMgrEntry_t entry;
//  526 
//  527   // Look up the long address of the device
//  528 
//  529   entry.user = ADDRMGR_USER_DEFAULT;
//  530   entry.nwkAddr = shortAddr;
//  531 
//  532   if ( AddrMgrEntryLookupNwk( &entry ) )
//  533   {
//  534     // check if APS link key has been established
//  535     if ( APSME_IsLinkKeyValid( entry.extAddr ) == TRUE )
//  536     {
//  537       status = ZSuccess;
//  538     }
//  539   }
//  540   else
//  541   {
//  542     // It's an unknown device
//  543     status = ZInvalidParameter;
//  544   }
//  545 
//  546   return status;
//  547 }
//  548 #endif
//  549 
//  550 /*********************************************************************
//  551  * @fn      simplemeter_HandleKeys
//  552  *
//  553  * @brief   Handles all key events for this device.
//  554  *
//  555  * @param   shift - true if in shift/alt.
//  556  * @param   keys - bit field for key events. Valid entries:
//  557  *                 HAL_KEY_SW_4
//  558  *                 HAL_KEY_SW_3
//  559  *                 HAL_KEY_SW_2
//  560  *                 HAL_KEY_SW_1
//  561  *
//  562  * @return  none
//  563  */
//  564 static void simplemeter_HandleKeys( uint8 shift, uint8 keys )
//  565 {
//  566   // Shift is used to make each button/switch dual purpose.
//  567   if ( shift )
//  568   {
//  569     if ( keys & HAL_KEY_SW_1 )
//  570     {
//  571     }
//  572     if ( keys & HAL_KEY_SW_2 )
//  573     {
//  574     }
//  575     if ( keys & HAL_KEY_SW_3 )
//  576     {
//  577     }
//  578     if ( keys & HAL_KEY_SW_4 )
//  579     {
//  580     }
//  581   }
//  582   else
//  583   {
//  584     if ( keys & HAL_KEY_SW_1 )
//  585     {
//  586       ZDOInitDevice(0);  // Join the network.
//  587     }
//  588 
//  589     if ( keys & HAL_KEY_SW_2 )
//  590     {
//  591 
//  592     }
//  593 
//  594     if ( keys & HAL_KEY_SW_3 )
//  595     {
//  596 
//  597     }
//  598 
//  599     if ( keys & HAL_KEY_SW_4 )
//  600     {
//  601 
//  602     }
//  603   }
//  604 }
//  605 
//  606 /*********************************************************************
//  607  * @fn      simplemeter_ValidateAttrDataCB
//  608  *
//  609  * @brief   Check to see if the supplied value for the attribute data
//  610  *          is within the specified range of the attribute.
//  611  *
//  612  * @param   pAttr - pointer to attribute
//  613  * @param   pAttrInfo - pointer to attribute info
//  614  *
//  615  * @return  TRUE if data valid. FALSE otherwise.
//  616  */

        RSEG CODE:CODE:REORDER:NOROOT(1)
//  617 static uint8 simplemeter_ValidateAttrDataCB( zclAttrRec_t *pAttr, zclWriteRec_t *pAttrInfo )
simplemeter_ValidateAttrDataCB:
          CFI Block cfiBlock8 Using cfiCommon0
          CFI Function simplemeter_ValidateAttrDataCB
//  618 {
//  619   uint8 valid = TRUE;
        MOV.B   #0x1, R12
//  620 
//  621   switch ( pAttrInfo->dataType )
        CMP.B   #0x10, 0x2(R13)
        JNE     ??simplemeter_ValidateAttrDataCB_0
//  622   {
//  623     case ZCL_DATATYPE_BOOLEAN:
//  624       if ( ( *(pAttrInfo->attrData) != 0 ) && ( *(pAttrInfo->attrData) != 1 ) )
        MOV.W   0x4(R13), R15
        MOV.B   @R15, R14
        CMP.B   #0x0, R14
        JEQ     ??simplemeter_ValidateAttrDataCB_0
        CMP.B   #0x1, R14
        JEQ     ??simplemeter_ValidateAttrDataCB_0
//  625         valid = FALSE;
        MOV.B   #0x0, R12
//  626       break;
//  627 
//  628     default:
//  629       break;
//  630   }
//  631 
//  632   return ( valid );
??simplemeter_ValidateAttrDataCB_0:
        RETA
          CFI EndBlock cfiBlock8
//  633 }
//  634 
//  635 /*********************************************************************
//  636  * @fn      simplemeter_BasicResetCB
//  637  *
//  638  * @brief   Callback from the ZCL General Cluster Library to set all
//  639  *          the attributes of all the clusters to their factory defaults
//  640  *
//  641  * @param   none
//  642  *
//  643  * @return  none
//  644  */

        RSEG CODE:CODE:REORDER:NOROOT(1)
//  645 static void simplemeter_BasicResetCB( void )
simplemeter_BasicResetCB:
          CFI Block cfiBlock9 Using cfiCommon0
          CFI Function simplemeter_BasicResetCB
//  646 {
//  647   // user should handle setting attributes to factory defaults here
//  648 }
        RETA
          CFI EndBlock cfiBlock9
//  649 
//  650 /*********************************************************************
//  651  * @fn      simplemeter_IdentifyCB
//  652  *
//  653  * @brief   Callback from the ZCL General Cluster Library when
//  654  *          it received an Identity Command for this application.
//  655  *
//  656  * @param   pCmd - pointer to structure for identify command
//  657  *
//  658  * @return  none
//  659  */

        RSEG CODE:CODE:REORDER:NOROOT(1)
//  660 static void simplemeter_IdentifyCB( zclIdentify_t *pCmd )
simplemeter_IdentifyCB:
          CFI Block cfiBlock10 Using cfiCommon0
          CFI Function simplemeter_IdentifyCB
//  661 {
//  662   simpleMeterIdentifyTime = pCmd->identifyTime;
        FUNCALL simplemeter_IdentifyCB, simplemeter_ProcessIdentifyTimeChange
        LOCFRAME CSTACK, 4, STACK
        MOV.W   0x2(R12), &simpleMeterIdentifyTime
//  663   simplemeter_ProcessIdentifyTimeChange();
        BRA     #simplemeter_ProcessIdentifyTimeChange
          CFI EndBlock cfiBlock10
//  664 }
//  665 
//  666 /*********************************************************************
//  667  * @fn      simplemeter_IdentifyQueryRspCB
//  668  *
//  669  * @brief   Callback from the ZCL General Cluster Library when
//  670  *          it received an Identity Query Response Command for this application.
//  671  *
//  672  * @param   pRsp - pointer to structure for identify query response
//  673  *
//  674  * @return  none
//  675  */

        RSEG CODE:CODE:REORDER:NOROOT(1)
//  676 static void simplemeter_IdentifyQueryRspCB( zclIdentifyQueryRsp_t *pRsp )
simplemeter_IdentifyQueryRspCB:
          CFI Block cfiBlock11 Using cfiCommon0
          CFI Function simplemeter_IdentifyQueryRspCB
//  677 {
//  678   // add user code here
//  679 }
        RETA
          CFI EndBlock cfiBlock11
//  680 
//  681 
//  682 
//  683 /*********************************************************************
//  684  * @fn      simplemeter_AlarmCB
//  685  *
//  686  * @brief   Callback from the ZCL General Cluster Library when
//  687  *          it received an Alarm request or response command for
//  688  *          this application.
//  689  *
//  690  * @param   pAlarm - pointer to structure for alarm command
//  691  *
//  692  * @return  none
//  693  */

        RSEG CODE:CODE:REORDER:NOROOT(1)
//  694 static void simplemeter_AlarmCB( zclAlarm_t *pAlarm )
simplemeter_AlarmCB:
          CFI Block cfiBlock12 Using cfiCommon0
          CFI Function simplemeter_AlarmCB
//  695 {
//  696   // add user code here
//  697 }
        RETA
          CFI EndBlock cfiBlock12
//  698 
//  699 /*********************************************************************
//  700  * @fn      simplemeter_GetProfileCmdCB
//  701  *
//  702  * @brief   Callback from the ZCL SE Profile Simple Metering Cluster Library when
//  703  *          it received a Get Profile Command for
//  704  *          this application.
//  705  *
//  706  * @param   pCmd - pointer to get profile command structure
//  707  * @param   srcAddr - pointer to source address
//  708  * @param   seqNum - sequence number of this command
//  709  *
//  710  * @return  none
//  711  */

        RSEG CODE:CODE:REORDER:NOROOT(1)
//  712 static void simplemeter_GetProfileCmdCB( zclCCGetProfileCmd_t *pCmd, afAddrType_t *srcAddr, uint8 seqNum )
simplemeter_GetProfileCmdCB:
          CFI Block cfiBlock13 Using cfiCommon0
          CFI Function simplemeter_GetProfileCmdCB
//  713 {
        FUNCALL simplemeter_GetProfileCmdCB, zclSE_SimpleMetering_Send_GetProfileRsp
        LOCFRAME CSTACK, 40, STACK
        PUSHM.W #0x2, R11
          CFI R10L Frame(CFA, -8)
          CFI R11L Frame(CFA, -6)
          CFI CFA SP+8
        SUB.W   #0x14, SP
          CFI CFA SP+28
        MOV.W   R12, R10
        MOV.W   R13, R11
        MOV.B   R14, R15
//  714 #if defined ( ZCL_SIMPLE_METERING )
//  715   // Upon receipt of the Get Profile Command, the metering device shall send
//  716   // Get Profile Response back.
//  717 
//  718   // Variables in the following are initialized to arbitrary value for test purpose
//  719   // In real application, user shall look up the interval data captured during
//  720   // the period specified in the pCmd->endTime and return corresponding data.
//  721 
//  722   uint32 endTime;
//  723   uint8  status = zclSE_SimpleMeter_GetProfileRsp_Status_Success;
//  724   uint8  profileIntervalPeriod = PROFILE_INTERVAL_PERIOD_60MIN;
//  725   uint8  numberOfPeriodDelivered = 5;
//  726   uint24 intervals[] = {0xa00001, 0xa00002, 0xa00003, 0xa00004, 0xa00005};
        MOV.W   SP, R12
        MOV.W   #`?<Constant {10485761L, 10485762L, 10485763L, 1`, R14
        MOV.W   #0xa, R13
        CALLA   #?CopyMemoryWords
//  727 
//  728   // endTime: 32 bit value (in UTC) representing the end time of the most
//  729   // chronologically recent interval being requested.
//  730   // Example: Data collected from 2:00 PM to 3:00 PM would be specified as a
//  731   // 3:00 PM interval (end time).
//  732 
//  733   // The Intervals block returned shall be the most recent block with
//  734   // its EndTime equal or older to the one in the request (pCmd->endTime).
//  735   // Requested End Time with value 0xFFFFFFFF indicats the most recent
//  736   // Intervals block is requested.
//  737 
//  738   // Sample Code - assuming the end time of the requested block is the same as
//  739   // it in the request.
//  740   endTime = pCmd->endTime;
//  741 
//  742   // Send Get Profile Response Command back
//  743 
//  744   zclSE_SimpleMetering_Send_GetProfileRsp( SIMPLEMETER_ENDPOINT, srcAddr, endTime,
//  745                                            status,
//  746                                            profileIntervalPeriod,
//  747                                            numberOfPeriodDelivered, intervals,
//  748                                            FALSE, seqNum );
        PUSH.B  R15
          CFI CFA SP+30
        PUSH.B  #0x0
          CFI CFA SP+32
        MOV.W   SP, R15
        ADD.W   #0x4, R15
        PUSH.W  R15
          CFI CFA SP+34
        PUSH.B  #0x5
          CFI CFA SP+36
        PUSH.B  #0x1
          CFI CFA SP+38
        PUSH.B  #0x0
          CFI CFA SP+40
        MOV.W   0x2(R10), R14
        MOV.W   0x4(R10), R15
        MOV.W   R11, R13
        MOV.B   #0x9, R12
        CALLA   #zclSE_SimpleMetering_Send_GetProfileRsp
//  749 #endif // ZCL_SIMPLE_METERING
//  750 }
        ADD.W   #0x20, SP
          CFI CFA SP+8
        POPM.W  #0x2, R11
          CFI R10L SameValue
          CFI R11L SameValue
          CFI CFA SP+4
        RETA
          CFI EndBlock cfiBlock13
//  751 
//  752 /*********************************************************************
//  753  * @fn      simplemeter_GetProfileRspCB
//  754  *
//  755  * @brief   Callback from the ZCL SE Profile Simple Metering Cluster Library when
//  756  *          it received a Get Profile Response for
//  757  *          this application.
//  758  *
//  759  * @param   pCmd - pointer to get profile response structure
//  760  * @param   srcAddr - pointer to source address
//  761  * @param   seqNum - sequence number of this command
//  762  *
//  763  * @return  none
//  764  */

        RSEG CODE:CODE:REORDER:NOROOT(1)
//  765 static void simplemeter_GetProfileRspCB( zclCCGetProfileRsp_t *pCmd, afAddrType_t *srcAddr, uint8 seqNum )
simplemeter_GetProfileRspCB:
          CFI Block cfiBlock14 Using cfiCommon0
          CFI Function simplemeter_GetProfileRspCB
//  766 {
//  767   // add user code here
//  768 }
        RETA
          CFI EndBlock cfiBlock14
//  769 
//  770 /*********************************************************************
//  771  * @fn      simplemeter_ReqMirrorCmdCB
//  772  *
//  773  * @brief   Callback from the ZCL SE Profile Simple Metering Cluster Library when
//  774  *          it received a Request Mirror Command for
//  775  *          this application.
//  776  *
//  777  * @param   srcAddr - pointer to source address
//  778  * @param   seqNum - sequence number of this command
//  779  *
//  780  * @return  none
//  781  */

        RSEG CODE:CODE:REORDER:NOROOT(1)
//  782 static void simplemeter_ReqMirrorCmdCB( afAddrType_t *srcAddr, uint8 seqNum )
simplemeter_ReqMirrorCmdCB:
          CFI Block cfiBlock15 Using cfiCommon0
          CFI Function simplemeter_ReqMirrorCmdCB
//  783 {
//  784   // add user code here
//  785 }
        RETA
          CFI EndBlock cfiBlock15
//  786 /*********************************************************************
//  787  * @fn      simplemeter_ReqMirrorRspCB
//  788  *
//  789  * @brief   Callback from the ZCL SE Profile Simple Metering Cluster Library when
//  790  *          it received a Request Mirror Response for
//  791  *          this application.
//  792  *
//  793  * @param   pRsp - pointer to request mirror response structure
//  794  * @param   srcAddr - pointer to source address
//  795  * @param   seqNum - sequence number of this command
//  796  *
//  797  * @return  none
//  798  */

        RSEG CODE:CODE:REORDER:NOROOT(1)
//  799 static void simplemeter_ReqMirrorRspCB( zclCCReqMirrorRsp_t *pRsp, afAddrType_t *srcAddr, uint8 seqNum )
simplemeter_ReqMirrorRspCB:
          CFI Block cfiBlock16 Using cfiCommon0
          CFI Function simplemeter_ReqMirrorRspCB
//  800 {
//  801   // add user code here
//  802 }
        RETA
          CFI EndBlock cfiBlock16
//  803 /*********************************************************************
//  804  * @fn      simplemeter_MirrorRemCmdCB
//  805  *
//  806  * @brief   Callback from the ZCL SE Profile Simple Metering Cluster Library when
//  807  *          it received a Mirror Remove Command for
//  808  *          this application.
//  809  *
//  810  * @param   srcAddr - pointer to source address
//  811  * @param   seqNum - sequence number of this command
//  812  *
//  813  * @return  none
//  814  */

        RSEG CODE:CODE:REORDER:NOROOT(1)
//  815 static void simplemeter_MirrorRemCmdCB( afAddrType_t *srcAddr, uint8 seqNum )
simplemeter_MirrorRemCmdCB:
          CFI Block cfiBlock17 Using cfiCommon0
          CFI Function simplemeter_MirrorRemCmdCB
//  816 {
//  817  // add user code here
//  818 }
        RETA
          CFI EndBlock cfiBlock17
//  819 /*********************************************************************
//  820  * @fn      simplemeter_MirrorRemRspCB
//  821  *
//  822  * @brief   Callback from the ZCL SE Profile Simple Metering Cluster Library when
//  823  *          it received a Mirror Remove Response for
//  824  *          this application.
//  825  *
//  826  * @param   pCmd - pointer to mirror remove response structure
//  827  * @param   srcAddr - pointer to source address
//  828  * @param   seqNum - sequence number of this command
//  829  *
//  830  * @return  none
//  831  */

        RSEG CODE:CODE:REORDER:NOROOT(1)
//  832 static void simplemeter_MirrorRemRspCB( zclCCMirrorRemRsp_t *pCmd, afAddrType_t *srcAddr, uint8 seqNum )
simplemeter_MirrorRemRspCB:
          CFI Block cfiBlock18 Using cfiCommon0
          CFI Function simplemeter_MirrorRemRspCB
//  833 {
//  834   // add user code here
//  835 }
        RETA
          CFI EndBlock cfiBlock18
//  836 
//  837 
//  838 /******************************************************************************
//  839  *
//  840  *  Functions for processing ZCL Foundation incoming Command/Response messages
//  841  *
//  842  *****************************************************************************/
//  843 
//  844 /*********************************************************************
//  845  * @fn      simplemeter_ProcessZCLMsg
//  846  *
//  847  * @brief   Process ZCL Foundation incoming message
//  848  *
//  849  * @param   pInMsg - message to process
//  850  *
//  851  * @return  none
//  852  */

        RSEG CODE:CODE:REORDER:NOROOT(1)
//  853 static void simplemeter_ProcessZCLMsg( zclIncomingMsg_t *pInMsg )
simplemeter_ProcessZCLMsg:
          CFI Block cfiBlock19 Using cfiCommon0
          CFI Function simplemeter_ProcessZCLMsg
//  854 {
        FUNCALL simplemeter_ProcessZCLMsg, simplemeter_ProcessInConfigReportCmd
        LOCFRAME CSTACK, 8, STACK
        FUNCALL simplemeter_ProcessZCLMsg, simplemeter_ProcessInConfigReportRspCmd
        LOCFRAME CSTACK, 8, STACK
        FUNCALL simplemeter_ProcessZCLMsg, simplemeter_ProcessInReadReportCfgCmd
        LOCFRAME CSTACK, 8, STACK
        FUNCALL simplemeter_ProcessZCLMsg, osal_mem_free
        LOCFRAME CSTACK, 8, STACK
        PUSHM.W #0x2, R11
          CFI R10L Frame(CFA, -8)
          CFI R11L Frame(CFA, -6)
          CFI CFA SP+8
        MOV.W   R12, R10
//  855   switch ( pInMsg->zclHdr.commandID )
        MOV.W   R12, R11
        ADD.W   #0x18, R11
        MOV.B   0x7(R12), R14
        SUB.B   #0x1, R14
        JEQ     ??simplemeter_ProcessZCLMsg_4
        SUB.B   #0x3, R14
        JEQ     ??simplemeter_ProcessZCLMsg_5
        SUB.B   #0x2, R14
        JEQ     ??simplemeter_ProcessZCLMsg_6
        SUB.B   #0x1, R14
        JEQ     ??simplemeter_ProcessZCLMsg_7
        SUB.B   #0x1, R14
        JEQ     ??simplemeter_ProcessZCLMsg_8
        SUB.B   #0x1, R14
        JEQ     ??simplemeter_ProcessZCLMsg_9
        SUB.B   #0x1, R14
        JEQ     ??simplemeter_ProcessZCLMsg_10
        JMP     ??simplemeter_ProcessZCLMsg_11
//  856   {
//  857 #if defined ( ZCL_READ )
//  858     case ZCL_CMD_READ_RSP:
//  859       simplemeter_ProcessInReadRspCmd( pInMsg );
??simplemeter_ProcessZCLMsg_4:
        MOV.W   @R11, R15
        MOV.B   #0x0, R14
??simplemeter_ProcessZCLMsg_0:
        CMP.B   @R15, R14
        JC      ??simplemeter_ProcessZCLMsg_11
        ADD.B   #0x1, R14
        JMP     ??simplemeter_ProcessZCLMsg_0
//  860       break;
//  861 #endif // ZCL_READ
//  862 #if defined ( ZCL_WRITE )
//  863     case ZCL_CMD_WRITE_RSP:
//  864       simplemeter_ProcessInWriteRspCmd( pInMsg );
??simplemeter_ProcessZCLMsg_5:
        MOV.W   @R11, R15
        MOV.B   #0x0, R14
??simplemeter_ProcessZCLMsg_1:
        CMP.B   @R15, R14
        JC      ??simplemeter_ProcessZCLMsg_11
        ADD.B   #0x1, R14
        JMP     ??simplemeter_ProcessZCLMsg_1
//  865       break;
//  866 #endif // ZCL_READ
//  867 #if defined ( ZCL_REPORT )
//  868     case ZCL_CMD_CONFIG_REPORT:
//  869       simplemeter_ProcessInConfigReportCmd( pInMsg );
??simplemeter_ProcessZCLMsg_6:
        CALLA   #simplemeter_ProcessInConfigReportCmd
//  870       break;
        JMP     ??simplemeter_ProcessZCLMsg_11
//  871 
//  872     case ZCL_CMD_CONFIG_REPORT_RSP:
//  873       simplemeter_ProcessInConfigReportRspCmd( pInMsg );
??simplemeter_ProcessZCLMsg_7:
        CALLA   #simplemeter_ProcessInConfigReportRspCmd
//  874       break;
        JMP     ??simplemeter_ProcessZCLMsg_11
//  875 
//  876     case ZCL_CMD_READ_REPORT_CFG:
//  877       simplemeter_ProcessInReadReportCfgCmd( pInMsg );
??simplemeter_ProcessZCLMsg_8:
        CALLA   #simplemeter_ProcessInReadReportCfgCmd
//  878       break;
        JMP     ??simplemeter_ProcessZCLMsg_11
//  879 
//  880     case ZCL_CMD_READ_REPORT_CFG_RSP:
//  881       simplemeter_ProcessInReadReportCfgRspCmd( pInMsg );
??simplemeter_ProcessZCLMsg_9:
        MOV.W   @R11, R15
        MOV.B   #0x0, R14
??simplemeter_ProcessZCLMsg_2:
        CMP.B   @R15, R14
        JC      ??simplemeter_ProcessZCLMsg_11
        ADD.B   #0x1, R14
        JMP     ??simplemeter_ProcessZCLMsg_2
//  882       break;
//  883 
//  884     case ZCL_CMD_REPORT:
//  885       simplemeter_ProcessInReportCmd( pInMsg );
??simplemeter_ProcessZCLMsg_10:
        MOV.W   @R11, R15
        MOV.B   #0x0, R14
        JMP     ??simplemeter_ProcessZCLMsg_12
??simplemeter_ProcessZCLMsg_3:
        ADD.B   #0x1, R14
??simplemeter_ProcessZCLMsg_12:
        CMP.B   @R15, R14
        JNC     ??simplemeter_ProcessZCLMsg_3
??simplemeter_ProcessZCLMsg_11:
        CMP.W   #0x0, 0x18(R10)
        JEQ     ??simplemeter_ProcessZCLMsg_13
//  886       break;
//  887 #endif // ZCL_REPORT
//  888     case ZCL_CMD_DEFAULT_RSP:
//  889       simplemeter_ProcessInDefaultRspCmd( pInMsg );
//  890       break;
//  891 #if defined ( ZCL_DISCOVER )
//  892     case ZCL_CMD_DISCOVER_RSP:
//  893       simplemeter_ProcessInDiscRspCmd( pInMsg );
//  894       break;
//  895 #endif // ZCL_DISCOVER
//  896     default:
//  897       break;
//  898   }
//  899 
//  900   if ( pInMsg->attrCmd != NULL )
//  901   {
//  902     // free the parsed command
//  903     osal_mem_free( pInMsg->attrCmd );
        MOV.W   @R11, R12
        CALLA   #osal_mem_free
//  904     pInMsg->attrCmd = NULL;
        MOV.W   #0x0, 0x18(R10)
//  905   }
//  906 }
??simplemeter_ProcessZCLMsg_13:
        POPM.W  #0x2, R11
          CFI R10L SameValue
          CFI R11L SameValue
          CFI CFA SP+4
        RETA
          CFI EndBlock cfiBlock19

        RSEG CODE:CODE:NOROOT(1)
simplemeter_ProcessInReadReportCfgCmd:
          CFI Block cfiBlock20 Using cfiCommon0
          CFI Function simplemeter_ProcessInReadReportCfgCmd
        FUNCALL simplemeter_ProcessInReadReportCfgCmd, zclFindAttrRec
        LOCFRAME CSTACK, 24, STACK
        FUNCALL simplemeter_ProcessInReadReportCfgCmd, zclAnalogDataType
        LOCFRAME CSTACK, 24, STACK
        FUNCALL simplemeter_ProcessInReadReportCfgCmd, zclGetDataTypeLength
        LOCFRAME CSTACK, 24, STACK
        FUNCALL simplemeter_ProcessInReadReportCfgCmd, osal_mem_alloc
        LOCFRAME CSTACK, 24, STACK
        FUNCALL simplemeter_ProcessInReadReportCfgCmd, zclFindAttrRec
        LOCFRAME CSTACK, 24, STACK
        FUNCALL simplemeter_ProcessInReadReportCfgCmd, zcl_SendReadReportCfgRspCmd
        LOCFRAME CSTACK, 30, STACK
        FUNCALL simplemeter_ProcessInReadReportCfgCmd, osal_mem_free
        LOCFRAME CSTACK, 30, STACK
        PUSHM.W #0x6, R11
          CFI R6L Frame(CFA, -16)
          CFI R7L Frame(CFA, -14)
          CFI R8L Frame(CFA, -12)
          CFI R9L Frame(CFA, -10)
          CFI R10L Frame(CFA, -8)
          CFI R11L Frame(CFA, -6)
          CFI CFA SP+16
        SUB.W   #0x8, SP
          CFI CFA SP+24
        MOV.W   R12, R8
        MOV.B   #0x0, R11
        MOV.W   0x18(R12), R9
        MOV.B   #0x0, R10
        JMP     ??simplemeter_ProcessInReadReportCfgCmd_2
??simplemeter_ProcessInReadReportCfgCmd_0:
        MOV.W   SP, R15
        MOV.B   R10, R7
        RLAM.W  #0x2, R7
        MOV.W   R9, R14
        ADD.W   R7, R14
        MOV.W   0x4(R14), R14
        CALLA   #?Subroutine1
??CrossCallReturnLabel_2:
        JEQ     ??simplemeter_ProcessInReadReportCfgCmd_3
        MOV.B   0x4(SP), R12
        CALLA   #zclAnalogDataType
        CMP.B   #0x0, R12
        JEQ     ??simplemeter_ProcessInReadReportCfgCmd_3
        MOV.B   0x4(SP), R12
        CALLA   #zclGetDataTypeLength
        BIT.B   #0x1, R12
        JNC     ??simplemeter_ProcessInReadReportCfgCmd_4
        ADD.B   #0x1, R12
??simplemeter_ProcessInReadReportCfgCmd_4:
        ADD.B   R12, R11
??simplemeter_ProcessInReadReportCfgCmd_3:
        ADD.B   #0x1, R10
??simplemeter_ProcessInReadReportCfgCmd_2:
        MOV.B   @R9, R14
        CMP.B   R14, R10
        JNC     ??simplemeter_ProcessInReadReportCfgCmd_0
        MOV.B   #0x2, R12
        RPT     #0xe
        ADDX.B  R14, R12
        MOV.B   R12, R12
        ADD.W   R11, R12
        CALLA   #osal_mem_alloc
        MOV.W   R12, R11
        CMP.W   #0x0, R12
        JNE     ??simplemeter_ProcessInReadReportCfgCmd_5
        MOV.B   #0x0, R12
        JMP     ??simplemeter_ProcessInReadReportCfgCmd_6
??simplemeter_ProcessInReadReportCfgCmd_5:
        MOV.B   @R9, 0(R12)
        MOV.B   #0x0, R10
        JMP     ??simplemeter_ProcessInReadReportCfgCmd_7
??simplemeter_ProcessInReadReportCfgCmd_1:
        MOV.B   R10, R15
        MOV.W   R15, R7
        RPT     #0xd
        ADDX.W  R15, R7
        MOV.W   R11, R6
        ADD.W   R7, R6
        ADD.W   #0x2, R6
        RLAM.W  #0x2, R15
        MOV.W   R9, R7
        ADD.W   R15, R7
        ADD.W   #0x4, R7
        MOV.W   SP, R15
        MOV.W   @R7, R14
        CALLA   #??Subroutine3_0
??CrossCallReturnLabel_4:
        JNE     ??simplemeter_ProcessInReadReportCfgCmd_8
        MOV.B   #0x86, R14
        JMP     ??simplemeter_ProcessInReadReportCfgCmd_9
??simplemeter_ProcessInReadReportCfgCmd_8:
        MOV.B   #0x8c, R14
??simplemeter_ProcessInReadReportCfgCmd_9:
        MOV.B   R14, 0(R6)
        MOV.W   @R7, 0x2(R6)
        ADD.B   #0x1, R10
??simplemeter_ProcessInReadReportCfgCmd_7:
        MOV.W   0x8(R8), R13
        CMP.B   @R9, R10
        JNC     ??simplemeter_ProcessInReadReportCfgCmd_1
        PUSH.B  0x6(R8)
          CFI CFA SP+26
        PUSH.B  #0x1
          CFI CFA SP+28
        PUSH.B  #0x1
          CFI CFA SP+30
        MOV.W   R11, R15
        MOV.W   R13, R14
        ADD.W   #0xa, R8
        MOV.W   R8, R13
        MOV.B   #0x9, R12
        CALLA   #zcl_SendReadReportCfgRspCmd
        MOV.W   R11, R12
        CALLA   #osal_mem_free
        MOV.B   #0x1, R12
        ADD.W   #0x6, SP
          CFI CFA SP+24
          CFI EndBlock cfiBlock20
??simplemeter_ProcessInReadReportCfgCmd_6:
        REQUIRE ?Subroutine0
        // Fall through to label ?Subroutine0
//  907 
//  908 #if defined ( ZCL_READ )
//  909 /*********************************************************************
//  910  * @fn      simplemeter_ProcessInReadRspCmd
//  911  *
//  912  * @brief   Process the "Profile" Read Response Command
//  913  *
//  914  * @param   pInMsg - incoming message to process
//  915  *
//  916  * @return  none
//  917  */
//  918 static uint8 simplemeter_ProcessInReadRspCmd( zclIncomingMsg_t *pInMsg )
//  919 {
//  920   zclReadRspCmd_t *readRspCmd;
//  921   uint8 i;
//  922 
//  923   readRspCmd = (zclReadRspCmd_t *)pInMsg->attrCmd;
//  924   for (i = 0; i < readRspCmd->numAttr; i++)
//  925   {
//  926     // Notify the originator of the results of the original read attributes
//  927     // attempt and, for each successfull request, the value of the requested
//  928     // attribute
//  929   }
//  930 
//  931   return TRUE;
//  932 }
//  933 #endif // ZCL_READ
//  934 
//  935 #if defined ( ZCL_WRITE )
//  936 /*********************************************************************
//  937  * @fn      simplemeter_ProcessInWriteRspCmd
//  938  *
//  939  * @brief   Process the "Profile" Write Response Command
//  940  *
//  941  * @param   pInMsg - incoming message to process
//  942  *
//  943  * @return  none
//  944  */
//  945 static uint8 simplemeter_ProcessInWriteRspCmd( zclIncomingMsg_t *pInMsg )
//  946 {
//  947   zclWriteRspCmd_t *writeRspCmd;
//  948   uint8 i;
//  949 
//  950   writeRspCmd = (zclWriteRspCmd_t *)pInMsg->attrCmd;
//  951   for (i = 0; i < writeRspCmd->numAttr; i++)
//  952   {
//  953     // Notify the device of the results of the its original write attributes
//  954     // command.
//  955   }
//  956 
//  957   return TRUE;
//  958 }
//  959 #endif // ZCL_WRITE
//  960 
//  961 #if defined ( ZCL_REPORT )
//  962 /*********************************************************************
//  963  * @fn      simplemeter_ProcessInConfigReportCmd
//  964  *
//  965  * @brief   Process the "Profile" Configure Reporting Command
//  966  *
//  967  * @param   pInMsg - incoming message to process
//  968  *
//  969  * @return  TRUE if attribute was found in the Attribute list,
//  970  *          FALSE if not
//  971  */

        RSEG CODE:CODE:NOROOT(1)
?Subroutine0:
          CFI Block cfiBlock21 Using cfiCommon0
          CFI NoFunction
          CFI CFA SP+24
          CFI R6L Frame(CFA, -16)
          CFI R7L Frame(CFA, -14)
          CFI R8L Frame(CFA, -12)
          CFI R9L Frame(CFA, -10)
          CFI R10L Frame(CFA, -8)
          CFI R11L Frame(CFA, -6)
//  972 static uint8 simplemeter_ProcessInConfigReportCmd( zclIncomingMsg_t *pInMsg )
//  973 {
//  974   zclCfgReportCmd_t *cfgReportCmd;
//  975   zclCfgReportRec_t *reportRec;
//  976   zclCfgReportRspCmd_t *cfgReportRspCmd;
//  977   zclAttrRec_t attrRec;
//  978   uint8 status;
//  979   uint8 i, j = 0;
//  980 
//  981   cfgReportCmd = (zclCfgReportCmd_t *)pInMsg->attrCmd;
//  982 
//  983   // Allocate space for the response command
//  984   cfgReportRspCmd = (zclCfgReportRspCmd_t *)osal_mem_alloc( sizeof ( zclCfgReportRspCmd_t ) + \ 
//  985                                         sizeof ( zclCfgReportStatus_t) * cfgReportCmd->numAttr );
//  986   if ( cfgReportRspCmd == NULL )
//  987     return FALSE; // EMBEDDED RETURN
//  988 
//  989   // Process each Attribute Reporting Configuration record
//  990   for ( i = 0; i < cfgReportCmd->numAttr; i++ )
//  991   {
//  992     reportRec = &(cfgReportCmd->attrList[i]);
//  993 
//  994     status = ZCL_STATUS_SUCCESS;
//  995 
//  996     if ( zclFindAttrRec( SIMPLEMETER_ENDPOINT, pInMsg->clusterId, reportRec->attrID, &attrRec ) )
//  997     {
//  998       if ( reportRec->direction == ZCL_SEND_ATTR_REPORTS )
//  999       {
// 1000         if ( reportRec->dataType == attrRec.attr.dataType )
// 1001         {
// 1002           // This the attribute that is to be reported
// 1003           if ( zcl_MandatoryReportableAttribute( &attrRec ) == TRUE )
// 1004           {
// 1005             if ( reportRec->minReportInt < SIMPLEMETER_MIN_REPORTING_INTERVAL ||
// 1006                  ( reportRec->maxReportInt != 0 &&
// 1007                    reportRec->maxReportInt < reportRec->minReportInt ) )
// 1008             {
// 1009               // Invalid fields
// 1010               status = ZCL_STATUS_INVALID_VALUE;
// 1011             }
// 1012             else
// 1013             {
// 1014               // Set the Min and Max Reporting Intervals and Reportable Change
// 1015               //status = zclSetAttrReportInterval( pAttr, cfgReportCmd );
// 1016               status = ZCL_STATUS_UNREPORTABLE_ATTRIBUTE; // for now
// 1017             }
// 1018           }
// 1019           else
// 1020           {
// 1021             // Attribute cannot be reported
// 1022             status = ZCL_STATUS_UNREPORTABLE_ATTRIBUTE;
// 1023           }
// 1024         }
// 1025         else
// 1026         {
// 1027           // Attribute data type is incorrect
// 1028           status = ZCL_STATUS_INVALID_DATA_TYPE;
// 1029         }
// 1030       }
// 1031       else
// 1032       {
// 1033         // We shall expect reports of values of this attribute
// 1034         if ( zcl_MandatoryReportableAttribute( &attrRec ) == TRUE )
// 1035         {
// 1036           // Set the Timeout Period
// 1037           //status = zclSetAttrTimeoutPeriod( pAttr, cfgReportCmd );
// 1038           status = ZCL_STATUS_UNSUPPORTED_ATTRIBUTE; // for now
// 1039         }
// 1040         else
// 1041         {
// 1042           // Reports of attribute cannot be received
// 1043           status = ZCL_STATUS_UNSUPPORTED_ATTRIBUTE;
// 1044         }
// 1045       }
// 1046     }
// 1047     else
// 1048     {
// 1049       // Attribute is not supported
// 1050       status = ZCL_STATUS_UNSUPPORTED_ATTRIBUTE;
// 1051     }
// 1052 
// 1053     // If not successful then record the status
// 1054     if ( status != ZCL_STATUS_SUCCESS )
// 1055     {
// 1056       cfgReportRspCmd->attrList[j].status = status;
// 1057       cfgReportRspCmd->attrList[j++].attrID = reportRec->attrID;
// 1058     }
// 1059   } // for loop
// 1060 
// 1061   if ( j == 0 )
// 1062   {
// 1063     // Since all attributes were configured successfully, include a single
// 1064     // attribute status record in the response command with the status field
// 1065     // set to SUCCESS and the attribute ID field omitted.
// 1066     cfgReportRspCmd->attrList[0].status = ZCL_STATUS_SUCCESS;
// 1067     cfgReportRspCmd->numAttr = 1;
// 1068   }
// 1069   else
// 1070   {
// 1071     cfgReportRspCmd->numAttr = j;
// 1072   }
// 1073 
// 1074   // Send the response back
// 1075   zcl_SendConfigReportRspCmd( SIMPLEMETER_ENDPOINT, &(pInMsg->srcAddr),
// 1076                               pInMsg->clusterId, cfgReportRspCmd, ZCL_FRAME_SERVER_CLIENT_DIR,
// 1077                               TRUE, pInMsg->zclHdr.transSeqNum );
// 1078   osal_mem_free( cfgReportRspCmd );
// 1079 
// 1080   return TRUE ;
        ADD.W   #0x8, SP
          CFI CFA SP+16
        POPM.W  #0x6, R11
          CFI CFA SP+4
          CFI R6L SameValue
          CFI R7L SameValue
          CFI R8L SameValue
          CFI R9L SameValue
          CFI R10L SameValue
          CFI R11L SameValue
        RETA
          CFI EndBlock cfiBlock21

        RSEG CODE:CODE:NOROOT(1)
simplemeter_ProcessInConfigReportRspCmd:
          CFI Block cfiBlock22 Using cfiCommon0
          CFI Function simplemeter_ProcessInConfigReportRspCmd
        FUNCALL simplemeter_ProcessInConfigReportRspCmd, zclFindAttrRec
        LOCFRAME CSTACK, 20, STACK
        PUSHM.W #0x4, R11
          CFI R8L Frame(CFA, -12)
          CFI R9L Frame(CFA, -10)
          CFI R10L Frame(CFA, -8)
          CFI R11L Frame(CFA, -6)
          CFI CFA SP+12
        SUB.W   #0x8, SP
          CFI CFA SP+20
        MOV.W   R12, R11
        MOV.W   0x18(R12), R8
        MOV.B   #0x0, R10
        JMP     ??simplemeter_ProcessInConfigReportRspCmd_1
??simplemeter_ProcessInConfigReportRspCmd_0:
        MOV.W   SP, R15
        MOV.B   R10, R14
        RLAM.W  #0x2, R14
        MOV.W   R8, R13
        ADD.W   R14, R13
        MOV.W   0x4(R13), R14
        MOV.W   0x8(R11), R13
        MOV.B   #0x9, R12
        CALLA   #zclFindAttrRec
        ADD.B   #0x1, R10
??simplemeter_ProcessInConfigReportRspCmd_1:
        CMP.B   @R8, R10
        JNC     ??simplemeter_ProcessInConfigReportRspCmd_0
        MOV.B   #0x1, R12
        ADD.W   #0x8, SP
          CFI CFA SP+12
        POPM.W  #0x4, R11
          CFI R10L SameValue
          CFI R11L SameValue
          CFI R8L SameValue
          CFI R9L SameValue
          CFI CFA SP+4
        RETA
          CFI EndBlock cfiBlock22

        RSEG CODE:CODE:REORDER:NOROOT(1)
simplemeter_ProcessInConfigReportCmd:
          CFI Block cfiBlock23 Using cfiCommon0
          CFI Function simplemeter_ProcessInConfigReportCmd
        FUNCALL simplemeter_ProcessInConfigReportCmd, osal_mem_alloc
        LOCFRAME CSTACK, 24, STACK
        FUNCALL simplemeter_ProcessInConfigReportCmd, zclFindAttrRec
        LOCFRAME CSTACK, 24, STACK
        FUNCALL simplemeter_ProcessInConfigReportCmd, zcl_SendConfigReportRspCmd
        LOCFRAME CSTACK, 30, STACK
        FUNCALL simplemeter_ProcessInConfigReportCmd, osal_mem_free
        LOCFRAME CSTACK, 30, STACK
        PUSHM.W #0x6, R11
          CFI R6L Frame(CFA, -16)
          CFI R7L Frame(CFA, -14)
          CFI R8L Frame(CFA, -12)
          CFI R9L Frame(CFA, -10)
          CFI R10L Frame(CFA, -8)
          CFI R11L Frame(CFA, -6)
          CFI CFA SP+16
        SUB.W   #0x8, SP
          CFI CFA SP+24
        MOV.W   R12, R8
        MOV.B   #0x0, R10
        MOV.W   0x18(R12), R9
        MOV.B   @R9, R12
        RLAM.W  #0x2, R12
        ADD.W   #0x2, R12
        CALLA   #osal_mem_alloc
        MOV.W   R12, R6
        CMP.W   #0x0, R12
        JNE     ??simplemeter_ProcessInConfigReportCmd_3
        MOV.B   #0x0, R12
        JMP     ??simplemeter_ProcessInConfigReportCmd_4
??simplemeter_ProcessInConfigReportCmd_3:
        MOV.B   #0x0, R11
        JMP     ??simplemeter_ProcessInConfigReportCmd_5
??simplemeter_ProcessInConfigReportCmd_0:
        MOV.B   #0x86, R14
??simplemeter_ProcessInConfigReportCmd_1:
        MOV.B   R10, R13
        RLAM.W  #0x2, R13
        MOV.W   R6, R15
        ADD.W   R13, R15
        MOV.B   R14, 0x2(R15)
        MOV.W   0x2(R7), 0x4(R15)
        ADD.B   #0x1, R10
        ADD.B   #0x1, R11
??simplemeter_ProcessInConfigReportCmd_5:
        CMP.B   @R9, R11
        JC      ??simplemeter_ProcessInConfigReportCmd_6
        MOV.W   R11, R15
        RPT     #0xd
        ADDX.W  R11, R15
        MOV.W   R9, R7
        ADD.W   R15, R7
        ADD.W   #0x2, R7
        MOV.W   SP, R15
        MOV.W   0x2(R7), R14
        CALLA   #?Subroutine1
??CrossCallReturnLabel_3:
        JEQ     ??simplemeter_ProcessInConfigReportCmd_0
        CMP.B   #0x0, 0(R7)
        JNE     ??simplemeter_ProcessInConfigReportCmd_0
        CMP.B   0x4(SP), 0x4(R7)
        JEQ     ??simplemeter_ProcessInConfigReportCmd_7
        MOV.B   #0x8d, R14
        JMP     ??simplemeter_ProcessInConfigReportCmd_1
??simplemeter_ProcessInConfigReportCmd_7:
        MOV.B   #0x8c, R14
        JMP     ??simplemeter_ProcessInConfigReportCmd_1
??simplemeter_ProcessInConfigReportCmd_6:
        CMP.B   #0x0, R10
        JNE     ??simplemeter_ProcessInConfigReportCmd_8
        MOV.B   #0x0, 0x2(R6)
        MOV.B   #0x1, 0(R6)
        JMP     ??simplemeter_ProcessInConfigReportCmd_9
??simplemeter_ProcessInConfigReportCmd_8:
        MOV.B   R10, 0(R6)
??simplemeter_ProcessInConfigReportCmd_9:
        PUSH.B  0x6(R8)
          CFI CFA SP+26
        PUSH.B  #0x1
          CFI CFA SP+28
        PUSH.B  #0x1
          CFI CFA SP+30
        MOV.W   R6, R15
        MOV.W   0x8(R8), R14
        ADD.W   #0xa, R8
        MOV.W   R8, R13
        MOV.B   #0x9, R12
        CALLA   #zcl_SendConfigReportRspCmd
        MOV.W   R6, R12
        CALLA   #osal_mem_free
        MOV.B   #0x1, R12
        ADD.W   #0x6, SP
          CFI CFA SP+24
??simplemeter_ProcessInConfigReportCmd_4:
        JMP     ?Subroutine0
        NOP
          CFI EndBlock cfiBlock23
// 1081 }

        RSEG CODE:CODE:NOROOT(1)
?Subroutine1:
          CFI Block cfiCond24 Using cfiCommon0
          CFI Function simplemeter_ProcessInReadReportCfgCmd
          CFI Conditional ??CrossCallReturnLabel_2
          CFI R6L Frame(CFA, -16)
          CFI R7L Frame(CFA, -14)
          CFI R8L Frame(CFA, -12)
          CFI R9L Frame(CFA, -10)
          CFI R10L Frame(CFA, -8)
          CFI R11L Frame(CFA, -6)
          CFI CFA SP+28
          CFI Block cfiCond25 Using cfiCommon0
          CFI (cfiCond25) Function simplemeter_ProcessInConfigReportCmd
          CFI (cfiCond25) Conditional ??CrossCallReturnLabel_3
          CFI (cfiCond25) R6L Frame(CFA, -16)
          CFI (cfiCond25) R7L Frame(CFA, -14)
          CFI (cfiCond25) R8L Frame(CFA, -12)
          CFI (cfiCond25) R9L Frame(CFA, -10)
          CFI (cfiCond25) R10L Frame(CFA, -8)
          CFI (cfiCond25) R11L Frame(CFA, -6)
          CFI (cfiCond25) CFA SP+28
          CFI Block cfiPicker26 Using cfiCommon1
          CFI (cfiPicker26) NoFunction
          CFI (cfiPicker26) Picker
// 1082 
// 1083 /*********************************************************************
// 1084  * @fn      simplemeter_ProcessInConfigReportRspCmd
// 1085  *
// 1086  * @brief   Process the "Profile" Configure Reporting Response Command
// 1087  *
// 1088  * @param   pInMsg - incoming message to process
// 1089  *
// 1090  * @return  none
// 1091  */
// 1092 static uint8 simplemeter_ProcessInConfigReportRspCmd( zclIncomingMsg_t *pInMsg )
// 1093 {
// 1094   zclCfgReportRspCmd_t *cfgReportRspCmd;
// 1095   zclAttrRec_t attrRec;
// 1096   uint8 i;
// 1097 
// 1098   cfgReportRspCmd = (zclCfgReportRspCmd_t *)pInMsg->attrCmd;
// 1099   for (i = 0; i < cfgReportRspCmd->numAttr; i++)
// 1100   {
// 1101     if ( zclFindAttrRec( SIMPLEMETER_ENDPOINT, pInMsg->clusterId,
// 1102                          cfgReportRspCmd->attrList[i].attrID, &attrRec ) )
// 1103     {
// 1104       // Notify the device of success (or otherwise) of the its original configure
// 1105       // reporting command, for each attribute.
// 1106     }
// 1107   }
// 1108 
// 1109   return TRUE;
// 1110 }
// 1111 
// 1112 /*********************************************************************
// 1113  * @fn      simplemeter_ProcessInReadReportCfgCmd
// 1114  *
// 1115  * @brief   Process the "Profile" Read Reporting Configuration Command
// 1116  *
// 1117  * @param   pInMsg - incoming message to process
// 1118  *
// 1119  * @return  none
// 1120  */
// 1121 static uint8 simplemeter_ProcessInReadReportCfgCmd( zclIncomingMsg_t *pInMsg )
// 1122 {
// 1123   zclReadReportCfgCmd_t *readReportCfgCmd;
// 1124   zclReadReportCfgRspCmd_t *readReportCfgRspCmd;
// 1125   zclReportCfgRspRec_t *reportRspRec;
// 1126   zclAttrRec_t attrRec;
// 1127   uint8 reportChangeLen;
// 1128   uint8 *dataPtr;
// 1129   uint8 hdrLen;
// 1130   uint8 dataLen = 0;
// 1131   uint8 status;
// 1132   uint8 i;
// 1133 
// 1134   readReportCfgCmd = (zclReadReportCfgCmd_t *)pInMsg->attrCmd;
// 1135 
// 1136   // Find out the response length (Reportable Change field is of variable length)
// 1137   for ( i = 0; i < readReportCfgCmd->numAttr; i++ )
// 1138   {
// 1139     // For supported attributes with 'analog' data type, find out the length of
// 1140     // the Reportable Change field
// 1141     if ( zclFindAttrRec( SIMPLEMETER_ENDPOINT, pInMsg->clusterId,
// 1142                          readReportCfgCmd->attrList[i].attrID, &attrRec ) )
        MOV.W   0x8(R8), R13
          CFI EndBlock cfiCond24
          CFI EndBlock cfiCond25
          CFI EndBlock cfiPicker26
        REQUIRE ??Subroutine3_0
        // Fall through to label ??Subroutine3_0

        RSEG CODE:CODE:REORDER:NOROOT(1)
??Subroutine3_0:
          CFI Block cfiCond27 Using cfiCommon0
          CFI Function simplemeter_ProcessInReadReportCfgCmd
          CFI Conditional ??CrossCallReturnLabel_4
          CFI R6L Frame(CFA, -16)
          CFI R7L Frame(CFA, -14)
          CFI R8L Frame(CFA, -12)
          CFI R9L Frame(CFA, -10)
          CFI R10L Frame(CFA, -8)
          CFI R11L Frame(CFA, -6)
          CFI CFA SP+28
          CFI Block cfiCond28 Using cfiCommon0
          CFI (cfiCond28) Function simplemeter_ProcessInReadReportCfgCmd
          CFI (cfiCond28) Conditional ??CrossCallReturnLabel_2
          CFI (cfiCond28) R6L Frame(CFA, -16)
          CFI (cfiCond28) R7L Frame(CFA, -14)
          CFI (cfiCond28) R8L Frame(CFA, -12)
          CFI (cfiCond28) R9L Frame(CFA, -10)
          CFI (cfiCond28) R10L Frame(CFA, -8)
          CFI (cfiCond28) R11L Frame(CFA, -6)
          CFI (cfiCond28) CFA SP+28
          CFI Block cfiCond29 Using cfiCommon0
          CFI (cfiCond29) Function simplemeter_ProcessInConfigReportCmd
          CFI (cfiCond29) Conditional ??CrossCallReturnLabel_3
          CFI (cfiCond29) R6L Frame(CFA, -16)
          CFI (cfiCond29) R7L Frame(CFA, -14)
          CFI (cfiCond29) R8L Frame(CFA, -12)
          CFI (cfiCond29) R9L Frame(CFA, -10)
          CFI (cfiCond29) R10L Frame(CFA, -8)
          CFI (cfiCond29) R11L Frame(CFA, -6)
          CFI (cfiCond29) CFA SP+28
          CFI Block cfiPicker30 Using cfiCommon1
          CFI (cfiPicker30) NoFunction
          CFI (cfiPicker30) Picker
// 1143     {
// 1144       if ( zclAnalogDataType( attrRec.attr.dataType ) )
// 1145       {
// 1146          reportChangeLen = zclGetDataTypeLength( attrRec.attr.dataType );
// 1147 
// 1148          // add padding if neede
// 1149          if ( PADDING_NEEDED( reportChangeLen ) )
// 1150            reportChangeLen++;
// 1151          dataLen += reportChangeLen;
// 1152       }
// 1153     }
// 1154   }
// 1155 
// 1156   hdrLen = sizeof( zclReadReportCfgRspCmd_t ) + ( readReportCfgCmd->numAttr * sizeof( zclReportCfgRspRec_t ) );
// 1157 
// 1158   // Allocate space for the response command
// 1159   readReportCfgRspCmd = (zclReadReportCfgRspCmd_t *)osal_mem_alloc( hdrLen + dataLen );
// 1160   if ( readReportCfgRspCmd == NULL )
// 1161     return FALSE; // EMBEDDED RETURN
// 1162 
// 1163   dataPtr = (uint8 *)( (uint8 *)readReportCfgRspCmd + hdrLen );
// 1164   readReportCfgRspCmd->numAttr = readReportCfgCmd->numAttr;
// 1165   for (i = 0; i < readReportCfgCmd->numAttr; i++)
// 1166   {
// 1167     reportRspRec = &(readReportCfgRspCmd->attrList[i]);
// 1168 
// 1169     if ( zclFindAttrRec( SIMPLEMETER_ENDPOINT, pInMsg->clusterId,
// 1170                          readReportCfgCmd->attrList[i].attrID, &attrRec ) )
        MOV.B   #0x9, R12
        CALLA   #zclFindAttrRec
        CMP.B   #0x0, R12
        RETA
          CFI EndBlock cfiCond27
          CFI EndBlock cfiCond28
          CFI EndBlock cfiCond29
          CFI EndBlock cfiPicker30

        RSEG DATA16_ID:CONST:SORT:NOROOT(0)
`?<Initializer for numAttr>`:
        DC8 1

        RSEG DATA16_ID:CONST:SORT:NOROOT(1)
`?<Initializer for simplemeter_GenCmdCallbacks>`:
        DC32 simplemeter_BasicResetCB, simplemeter_IdentifyCB
        DC32 simplemeter_IdentifyQueryRspCB, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H
        DC32 simplemeter_AlarmCB, 0H, 0H

        RSEG DATA16_ID:CONST:SORT:NOROOT(1)
`?<Initializer for simplemeter_SECmdCallbacks>`:
        DC32 simplemeter_GetProfileCmdCB, simplemeter_GetProfileRspCB
        DC32 simplemeter_ReqMirrorCmdCB, simplemeter_ReqMirrorRspCB
        DC32 simplemeter_MirrorRemCmdCB, simplemeter_MirrorRemRspCB, 0H, 0H, 0H
        DC32 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H

        RSEG CODE:CODE:REORDER:NOROOT(1)
?setjmp_save_r4:
        REQUIRE ?setjmp_r4
        REQUIRE ?longjmp_r4

        RSEG CODE:CODE:REORDER:NOROOT(1)
?setjmp_save_r5:
        REQUIRE ?setjmp_r5
        REQUIRE ?longjmp_r5

        RSEG DATA16_C:CONST:SORT:NOROOT(1)
`?<Constant {10485761L, 10485762L, 10485763L, 1`:
        DC32 10485761, 10485762, 10485763, 10485764, 10485765

        END
// 1171     {
// 1172       if ( zcl_MandatoryReportableAttribute( &attrRec ) == TRUE )
// 1173       {
// 1174         // Get the Reporting Configuration
// 1175         // status = zclReadReportCfg( readReportCfgCmd->attrID[i], reportRspRec );
// 1176         status = ZCL_STATUS_UNREPORTABLE_ATTRIBUTE; // for now
// 1177         if ( status == ZCL_STATUS_SUCCESS && zclAnalogDataType( attrRec.attr.dataType ) )
// 1178         {
// 1179           reportChangeLen = zclGetDataTypeLength( attrRec.attr.dataType );
// 1180           //osal_memcpy( dataPtr, pBuf, reportChangeLen );
// 1181           reportRspRec->reportableChange = dataPtr;
// 1182 
// 1183           // add padding if needed
// 1184           if ( PADDING_NEEDED( reportChangeLen ) )
// 1185             reportChangeLen++;
// 1186           dataPtr += reportChangeLen;
// 1187         }
// 1188       }
// 1189       else
// 1190       {
// 1191         // Attribute not in the Mandatory Reportable Attribute list
// 1192         status = ZCL_STATUS_UNREPORTABLE_ATTRIBUTE;
// 1193       }
// 1194     }
// 1195     else
// 1196     {
// 1197       // Attribute not found
// 1198       status = ZCL_STATUS_UNSUPPORTED_ATTRIBUTE;
// 1199     }
// 1200 
// 1201     reportRspRec->status = status;
// 1202     reportRspRec->attrID = readReportCfgCmd->attrList[i].attrID;
// 1203   }
// 1204 
// 1205   // Send the response back
// 1206   zcl_SendReadReportCfgRspCmd( SIMPLEMETER_ENDPOINT, &(pInMsg->srcAddr),
// 1207                                pInMsg->clusterId, readReportCfgRspCmd, ZCL_FRAME_SERVER_CLIENT_DIR,
// 1208                                TRUE, pInMsg->zclHdr.transSeqNum );
// 1209   osal_mem_free( readReportCfgRspCmd );
// 1210 
// 1211   return TRUE;
// 1212 }
// 1213 
// 1214 /*********************************************************************
// 1215  * @fn      simplemeter_ProcessInReadReportCfgRspCmd
// 1216  *
// 1217  * @brief   Process the "Profile" Read Reporting Configuration Response Command
// 1218  *
// 1219  * @param   pInMsg - incoming message to process
// 1220  *
// 1221  * @return  none
// 1222  */
// 1223 static uint8 simplemeter_ProcessInReadReportCfgRspCmd( zclIncomingMsg_t *pInMsg )
// 1224 {
// 1225   zclReadReportCfgRspCmd_t *readReportCfgRspCmd;
// 1226   zclReportCfgRspRec_t *reportRspRec;
// 1227   uint8 i;
// 1228 
// 1229   readReportCfgRspCmd = (zclReadReportCfgRspCmd_t *)pInMsg->attrCmd;
// 1230   for ( i = 0; i < readReportCfgRspCmd->numAttr; i++ )
// 1231   {
// 1232     reportRspRec = &(readReportCfgRspCmd->attrList[i]);
// 1233 
// 1234     // Notify the device of the results of the its original read reporting
// 1235     // configuration command.
// 1236 
// 1237     if ( reportRspRec->status == ZCL_STATUS_SUCCESS )
// 1238     {
// 1239       if ( reportRspRec->direction == ZCL_SEND_ATTR_REPORTS )
// 1240       {
// 1241         // add user code here
// 1242       }
// 1243       else
// 1244       {
// 1245         // expecting attribute reports
// 1246       }
// 1247     }
// 1248   }
// 1249 
// 1250   return TRUE;
// 1251 }
// 1252 
// 1253 /*********************************************************************
// 1254  * @fn      simplemeter_ProcessInReportCmd
// 1255  *
// 1256  * @brief   Process the "Profile" Report Command
// 1257  *
// 1258  * @param   pInMsg - incoming message to process
// 1259  *
// 1260  * @return  none
// 1261  */
// 1262 static uint8 simplemeter_ProcessInReportCmd( zclIncomingMsg_t *pInMsg )
// 1263 {
// 1264   zclReportCmd_t *reportCmd;
// 1265   uint8 i;
// 1266 
// 1267   reportCmd = (zclReportCmd_t *)pInMsg->attrCmd;
// 1268   for (i = 0; i < reportCmd->numAttr; i++)
// 1269   {
// 1270     // add user code here
// 1271   }
// 1272 
// 1273   return TRUE;
// 1274 }
// 1275 #endif // ZCL_REPORT
// 1276 
// 1277 /*********************************************************************
// 1278  * @fn      simplemeter_ProcessInDefaultRspCmd
// 1279  *
// 1280  * @brief   Process the "Profile" Default Response Command
// 1281  *
// 1282  * @param   pInMsg - incoming message to process
// 1283  *
// 1284  * @return  none
// 1285  */
// 1286 static uint8 simplemeter_ProcessInDefaultRspCmd( zclIncomingMsg_t *pInMsg )
// 1287 {
// 1288   // zclDefaultRspCmd_t *defaultRspCmd = (zclDefaultRspCmd_t *)pInMsg->attrCmd;
// 1289 
// 1290   // Device is notified of the Default Response command.
// 1291 
// 1292   return TRUE;
// 1293 }
// 1294 
// 1295 #if defined ( ZCL_DISCOVER )
// 1296 /*********************************************************************
// 1297  * @fn      simplemeter_ProcessInDiscRspCmd
// 1298  *
// 1299  * @brief   Process the "Profile" Discover Response Command
// 1300  *
// 1301  * @param   pInMsg - incoming message to process
// 1302  *
// 1303  * @return  none
// 1304  */
// 1305 static uint8 simplemeter_ProcessInDiscRspCmd( zclIncomingMsg_t *pInMsg )
// 1306 {
// 1307   zclDiscoverRspCmd_t *discoverRspCmd;
// 1308   uint8 i;
// 1309 
// 1310   discoverRspCmd = (zclDiscoverRspCmd_t *)pInMsg->attrCmd;
// 1311   for ( i = 0; i < discoverRspCmd->numAttr; i++ )
// 1312   {
// 1313     // Device is notified of the result of its attribute discovery command.
// 1314   }
// 1315 
// 1316   return TRUE;
// 1317 }
// 1318 #endif // ZCL_DISCOVER
// 1319 
// 1320 /****************************************************************************
// 1321 ****************************************************************************/
// 
// 1 294 bytes in segment CODE
//    20 bytes in segment DATA16_C
//   165 bytes in segment DATA16_I
//   165 bytes in segment DATA16_ID
//    16 bytes in segment DATA16_Z
// 
// 1 294 bytes of CODE  memory
//   185 bytes of CONST memory
//   181 bytes of DATA  memory
//
//Errors: none
//Warnings: none
